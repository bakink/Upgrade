
Oracle Installation & Upgrade 19c 

Contents
Oracle Installation & Upgrade 19c	1
ORACLE 19c Installation	1
ORACLE 19c UPGRADE	1
19C Downgrade	1


ORACLE 19c Installation

mkdir -p /u01/app/oracle/product/19.0.0.0/dbhome_1
cd /u01/app/oracle/product/19.0.0.0/dbhome_1
unzip -q /u01/oracle/setup/SOLARIS.SPARC64_193000_db_home.zip

export DISPLAY=10.5.28.189:0.0

./runInstaller -applyRU /u01/oracle/setup/30899722/30869156
Preparing the home to patch...
Applying the patch /u01/oracle/setup/30899722/30869156...
Successfully applied the patch.
The log can be found at: /u01/app/oraInventory/logs/InstallActions2020-08-21_02-45-02PM/installerPatchActions_2020-08-21_02-45-02PM.log
Launching Oracle Database Setup Wizard...

 
 
 
 
 
 
 
 

ORACLE 19c UPGRADE

 


Oracle 19c - Complete Checklist for Manual Upgrades to Non-CDB Oracle Database 19c (Doc ID 2539778.1) Dokümanı takip edilir.

1)	Upgrade için gerekli patch uygulanır.

Database Upgrade to 12.2, 18c, 19c fails with ORA-01422, ORA-06512 for SYS.DBMS_STATS (Doc ID 2525596.1)

Step3: Requirements and recommendations for target ORACLE_HOME
•	Verify the whether your operating system is certified for 19c.  Click here to launch certification portal
•	Install 19c, verify there are no installation related issues.
•	Download and install latest RU if any
•	Copy spfile or pfile from source ORACLE_HOME (under $ORACLE_HOME/dbs) to target home
o	Remove any _ (underscore) parameter, obsolete and deprecated parameters in pfile
o	Note min value of COMPATIBLE parameter to upgrade 19c is “11.2.0”, make sure you have COMPATIBLE parameter is set to 11.2.0 or greater
•	Review patch recommendations as given in the article "Patches to apply before upgrading Oracle GI and DB to 19c (Doc ID 2539751.1)" 
•	Apply patch 29213893 on target ORACLE_HOME to avoid ORA-01422 error - refer: Database Upgrade to 12.2, 18c, 19c fails with ORA-01422, ORA-06512 for SYS.DBMS_STATS (Doc ID 2525596.1)
[oracle@exa0101vm01 29213893]$ opatch apply -local
Oracle Interim Patch Installer version 12.2.0.1.19
Copyright (c) 2020, Oracle Corporation.  All rights reserved.


Oracle Home       : /u02/app/oracle/product/19.0.0/dbhome_1
Central Inventory : /u01/app/oraInventory
   from           : /u02/app/oracle/product/19.0.0/dbhome_1/oraInst.loc
OPatch version    : 12.2.0.1.19
OUI version       : 12.2.0.7.0
Log file location : /u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-02_10-46-32AM_1.log

Verifying environment and performing prerequisite checks...
OPatch continues with these patches:   29213893  

Do you want to proceed? [y|n]
y
User Responded with: Y
All checks passed.
Backing up files...
Applying interim patch '29213893' to OH '/u02/app/oracle/product/19.0.0/dbhome_1'

Patching component oracle.rdbms.dbscripts, 19.0.0.0.0...
Patch 29213893 successfully applied.
Log file location: /u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-02_10-46-32AM_1.log

OPatch succeeded.

[oracle@exa0101vm01 29213893]$ opatch lsinv | grep 29213893
Patch  29213893     : applied on Thu Apr 02 10:46:52 EET 2020
     29213893


2)	init.ora ve password file tüm node lara kopyalanır.
cp initFODB19.ora /u02/app/oracle/product/19.0.0/dbhome_1/dbs/
cp orapwFODB19 /u02/app/oracle/product/19.0.0/dbhome_1/dbs/

3)	TDE wallet ve sqlnet.ora tüm node lara kopyalanır.
 
cp sqlnet.ora ../../../dbhome_1/network/admin/
cd /u02/tde_wallets/fodbstby
cp * ../fodb19/

cp /u02/app/oracle/product/11.2.0/dbhome_1/network/admin/sqlnet.ora /u02/app/oracle/product/19.0.0/dbhome_1/network/admin

4)	init.ora düzenlenir. (Cluster parametreleri kaldırılır.)
*.audit_file_dest='/u02/app/oracle/admin/fodb19/adump'
*.audit_trail='db'
*.cluster_database=FALSE
*.compatible='11.2.0.4.0'
*.control_files='+DATAC1/fodb19/fodb19.ctl'
*.db_block_checking='FULL'
*.db_block_checksum='FULL'
*.db_block_size=8192
*.db_cache_size=5133828096
*.db_create_file_dest='+DATAC1'
*.db_domain=''
*.db_files=1024
*.db_lost_write_protect='TYPICAL'
*.db_name='foto'
*.db_recovery_file_dest='+RECOC1'
*.db_recovery_file_dest_size=1610612736000
*.db_unique_name='fodb19'
*.diagnostic_dest='/u01/app/oracle'
*.dispatchers='(PROTOCOL=TCP) (SERVICE=fotoXDB)'
*.fal_client='FOTOSTBY'
*.fal_server='FODBSTBY'
*.job_queue_processes=1000
*.log_archive_config='NODG_CONFIG'
*.log_archive_dest_1='LOCATION=USE_DB_RECOVERY_FILE_DEST'
*.log_archive_dest_5=''
*.log_archive_dest_state_3='DEFER'
*.log_archive_dest_state_5='DEFER'
*.log_archive_format='arc%t_%s_%r.arc'
*.log_archive_max_processes=5
*.open_cursors=300
*.pga_aggregate_target=1006632960
*.processes=800
*.redo_transport_user='DATA_GUARD'
*.remote_login_passwordfile='exclusive'
*.sec_case_sensitive_logon=FALSE
*.sessions=885
*.sga_max_size=8287944704
*.sga_target=0
*.shared_pool_size=855638016
*.standby_file_management='AUTO'
*.streams_pool_size=262144000
*.thread=1
*.undo_tablespace='UNDOTBS1'




5)	Restore point oluştur.
SQL> shu immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup mount
ORACLE instance started.

Total System Global Area 1.0689E+11 bytes
Fixed Size                  2265864 bytes
Variable Size            6.3888E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers               55242752 bytes
Database mounted.
SQL> CREATE RESTORE POINT before_upgrade_19 GUARANTEE FLASHBACK DATABASE;

Restore point created.

SQL> alter database open;

Database altered.


6)	dbconsole remove edilir.
oracle@efes:SYSINETTEST1:/u01/oracle> emctl stop dbconsole        
grep: can't open /etc/TIMEZONE
Environment variable ORACLE_UNQNAME not defined. Please set ORACLE_UNQNAME to database unique name. 
oracle@efes:SYSINETTEST1:/u01/oracle> sqlplus / as sysdba

SQL*Plus: Release 11.2.0.4.0 Production on Tue Sep 8 23:15:39 2020

Copyright (c) 1982, 2013, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
With the Partitioning, Real Application Clusters, Automatic Storage Management, Data Mining
and Real Application Testing options

SQL> show parameter uniq

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_unique_name                       string      SYSINETTEST_RAC
SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
With the Partitioning, Real Application Clusters, Automatic Storage Management, Data Mining
and Real Application Testing options
oracle@efes:SYSINETTEST1:/u01/oracle> export ORACLE_UNQNAME=SYSINETTEST_RAC

[oracle@exa0101vm01 dbs]$ emctl stop dbconsole        
OC4J Configuration issue. /u02/app/oracle/product/11.2.0/dbhome_1/oc4j/j2ee/OC4J_DBConsole_exa0101vm01_FODB19 not found. 

cd /u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/

SQL>SET ECHO ON
SQL>SET SERVEROUTPUT ON
SQL>@emremove.sql

SQL> Rem On Microsoft platforms, also delete the DB Console service, generally with name
SQL> Rem OracleDBConsole<sid>
SQL> Rem
SQL> Rem #############################################################################################
SQL> Rem
SQL> Rem
SQL> Rem    BEGIN SQL_FILE_METADATA
SQL> Rem    SQL_SOURCE_FILE: rdbms/admin/emremove.sql
SQL> Rem    SQL_SHIPPED_FILE: rdbms/admin/emremove.sql
SQL> Rem    SQL_PHASE: UTILITY
SQL> Rem    SQL_STARTUP_MODE: NORMAL
SQL> Rem    SQL_IGNORABLE_ERRORS: NONE
SQL> Rem    END SQL_FILE_METADATA
SQL> Rem
SQL> Rem    MODIFIED   (MM/DD/YY)
SQL> Rem    spramani    01/17/17 - fix for 24518751
SQL> Rem    spramani    08/03/16 - fix # 24330891
SQL> Rem    spramani    07/20/12 - more fix
SQL> Rem    spramani    12/21/11 - Created
SQL> Rem
SQL> 
SQL> 
SQL> DEFINE EM_REPOS_USER ="SYSMAN"
SQL> DEFINE LOGGING = "VERBOSE"
SQL> 
SQL> declare
  2  
  3    l_username dba_role_privs.grantee%type;
  4    l_user_name dba_role_privs.grantee%type;
  5    l_sql varchar2(1024);
  6    l_sysman_user number;
  7    l_mgmt_users_src number;
  8    l_sid number;
  9    l_serial number;
 10    err number;
 11    err_msg varchar2(128);
 12    c number;
 13    l_removejobs varchar2(1024);
 14    l_set_context varchar2(1024);
 15    l_client varchar2(16) := ' ';
 16    l_context integer := 5;
 17    l_verbose boolean := FALSE;
 18    l_msg varchar2(1024);
 19    l_open_acc number := 0;
 20  
 21    TYPE SESSION_REC IS RECORD
 22     (sid     v$session.sid%type,
 23      serial_no v$session.serial#%type);
 24    TYPE     SESSION_TYPE IS TABLE OF SESSION_REC;
 25    l_sessions SESSION_TYPE;
 26  
 27  
 28  
 29    l_job_process_count NUMBER ;
 30    TYPE TBSP_ARRAY IS TABLE OF varchar2(64) INDEX BY BINARY_INTEGER ;
 31    l_tablespaces TBSP_ARRAY;
 32  
 33      PROCEDURE set_job_process_count(p_count IN NUMBER)
 34      IS
 35      BEGIN
 36        --scope=memory so it will be reset on instance startup
 37        -- SID=* to take care of RAC
 38        IF p_count >=0
 39        THEN
 40          EXECUTE IMMEDIATE 'ALTER SYSTEM SET job_queue_processes='
 41                      ||p_count||' SID=''*'' scope=memory' ;
 42        END IF ;
 43      EXCEPTION WHEN OTHERS THEN NULL ;
 44      END set_job_process_count ;
 45  
 46      PROCEDURE LOG_MESSAGE (verbose boolean, message varchar2)
 47      IS
 48      BEGIN
 49          IF (verbose = TRUE)
 50          THEN
 51              DBMS_OUTPUT.PUT_LINE(message);
 52          END IF;
 53      END LOG_MESSAGE;
 54  
 55      FUNCTION get_job_process_count
 56      RETURN NUMBER
 57      IS
 58      l_value NUMBER ;
 59      BEGIN
 60        SELECT value
 61          INTO l_value
 62          FROM v$parameter
 63         WHERE name = 'job_queue_processes' ;
 64         RETURN(l_value) ;
 65      EXCEPTION
 66      WHEN OTHERS THEN
 67         RETURN(10) ;
 68      END get_job_process_count ;
 69  begin
 70      IF (upper('&LOGGING') = 'VERBOSE')
 71      THEN
 72        l_verbose := TRUE;
 73      END IF;
 74  
 75      LOG_MESSAGE(l_verbose,' This script will drop the Oracle Enterprise Manager related schemas and objects.');
 76      LOG_MESSAGE(l_verbose, ' This script might take few minutes to complete; it has 6 phases to complete the process.');
 77      LOG_MESSAGE(l_verbose,' The script may take longer if you have SYSMAN and related sessions are active');
 78      LOG_MESSAGE(l_verbose,' from Oracle Enterprise Manager(OEM) application.');
 79      LOG_MESSAGE(l_verbose,' ');
 80      LOG_MESSAGE(l_verbose,' ');
 81      LOG_MESSAGE(l_verbose,' Recommendations:');
 82      LOG_MESSAGE(l_verbose,' ');
 83      LOG_MESSAGE(l_verbose,' ');
 84      LOG_MESSAGE(l_verbose,' You are recommended to shutdown DB Control application immediately before running this');
 85      LOG_MESSAGE(l_verbose,' OEM repository removal script.');
 86      LOG_MESSAGE(l_verbose,' To shutdown DB Control application, you need to run: emctl stop dbconsole');
 87      LOG_MESSAGE(l_verbose,' ');
 88      LOG_MESSAGE(l_verbose,' ');
 89      LOG_MESSAGE(l_verbose,' Steps to be performed manually (after this script is run):');
 90      LOG_MESSAGE(l_verbose,' ');
 91      LOG_MESSAGE(l_verbose,' ');
 92      LOG_MESSAGE(l_verbose,' Please note that you need to remove the DB Control Configuration Files');
 93      LOG_MESSAGE(l_verbose,' manually to remove DB Control completly; remove the following');
 94      LOG_MESSAGE(l_verbose,' directories from your filesystem:');
 95      LOG_MESSAGE(l_verbose,' <ORACLE_HOME>/<hostname_sid>');
 96      LOG_MESSAGE(l_verbose,' <ORACLE_HOME>/oc4j/j2ee/OC4J_DBConsole_<hostname>_<sid>');
 97      LOG_MESSAGE(l_verbose,' ');
 98      LOG_MESSAGE(l_verbose,' If the dbcontrol is upgraded from lower version, for example, from 10.2.0.3 to 10.2.0.4,');
 99      LOG_MESSAGE(l_verbose,' then the following directory also needs to be removed from the file system.');
100      LOG_MESSAGE(l_verbose,' <ORACLE_HOME>/<hostname_sid>.upgrade');
101      LOG_MESSAGE(l_verbose,' <ORACLE_HOME>/oc4j/j2ee/OC4J_DBConsole_<hostname>_<sid>.upgrade');
102      LOG_MESSAGE(l_verbose,' ');
103      LOG_MESSAGE(l_verbose,' On Microsoft platforms, also delete the DB Console service, generally with name');
104      LOG_MESSAGE(l_verbose,' OracleDBConsole<sid>');
105  
106  
107      LOG_MESSAGE(l_verbose,'Starting phase 1 : Dropping AQ related objests, EM jobs and all Oracle Enterprise Manager related schemas; except SYSMAN ...');
108  
109      c := 0;
110      BEGIN
111          select count(1) into l_sysman_user from all_users where username='SYSMAN';
112      IF (l_sysman_user > 0 ) THEN
113      BEGIN
114  
115          BEGIN
116              LOG_MESSAGE(l_verbose,'dropping AQ related objests from SYSMAN ...');
117  
118              DBMS_AQADM.DROP_QUEUE_TABLE(queue_table=>'SYSMAN.MGMT_NOTIFY_QTABLE',force=>TRUE);
119          EXCEPTION
120              WHEN OTHERS THEN
121               err := SQLCODE;
122               LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: AQ related objects are dropped already or not found');
123          END;
124  
125          BEGIN
126              -- reduce job_queue_processes to zero
127             l_job_process_count := get_job_process_count ;
128             set_job_process_count(0) ;
129             LOG_MESSAGE(l_verbose,'saved job_queue_process=' || l_job_process_count || ', set to 0, now removing Oracle EM jobs ...');
130             l_removejobs := 'BEGIN ' ||  'SYSMAN' || '.emd_maintenance.remove_em_dbms_jobs; END;';
131             execute immediate l_removejobs;
132          EXCEPTION
133             WHEN OTHERS THEN
134                 err := SQLCODE;
135                 LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: EM jobs are dropped already or not found');
136          END;
137  
138      END;
139      END IF;
140      END;
141  
142      -- First, drop all users, except SYSMAN who have MGMT_USER role and
143      -- are created by EM. All users created by EM will have a record
144      -- in MGMT_CREATED_USERS table
145      --
146  
147      BEGIN
148          select count(1) into l_sysman_user from all_users where username='SYSMAN';
149          IF (l_sysman_user > 0 ) THEN
150          BEGIN
151  
152          LOOP  --  part 1 main loop
153                -- handle SYSMAN is partially dropped
154               select count(1) into l_mgmt_users_src from all_objects where object_name='MGMT_CREATED_USERS' and owner='SYSMAN';
155               IF(l_mgmt_users_src = 0 ) THEN
156                   EXIT;
157               END IF;
158          BEGIN
159            LOG_MESSAGE(l_verbose,'finding users who needs to be dropped ...');
160            l_username := '';
161            BEGIN
162                execute immediate 'select grantee
163                   from sys.dba_role_privs
164                   where granted_role ='||DBMS_ASSERT.ENQUOTE_LITERAL('MGMT_USER')||
165                    ' AND grantee IN (SELECT user_name
166                                 FROM SYSMAN.MGMT_CREATED_USERS
167                                  WHERE SYSTEM_USER=0)
168                    AND ROWNUM=1'
169                    into l_user_name;
170                 LOG_MESSAGE(l_verbose,'found user name: ' || l_user_name);
171                    l_username := DBMS_ASSERT.ENQUOTE_NAME(l_user_name, FALSE);
172  
173                 EXECUTE IMMEDIATE 'ALTER USER '||l_username||' ACCOUNT LOCK' ;
174            EXCEPTION
175                  WHEN NO_DATA_FOUND THEN
176                      LOG_MESSAGE(l_verbose,l_username || ' IS ALREADY DROPPED');
177                  EXIT; -- THEN RETURN ;
178            END ;
179  
180  
181            FOR cnt in 1 .. 150 LOOP -- session kill loop
182  
183              BEGIN
184                -- FOR crec in (SELECT sid, serial#
185                --               FROM v$session
186                --              WHERE username=l_username
187                --                AND status NOT IN('KILLED'))
188  
189                l_sql := 'SELECT sid, serial#
190                               FROM v$session
191                              WHERE username='|| DBMS_ASSERT.ENQUOTE_LITERAL(l_user_name)||'
192                              AND status NOT IN(''KILLED'')';
193                execute immediate l_sql BULK COLLECT INTO l_sessions;
194  
195                FOR i in 1..l_sessions.COUNT
196                LOOP   --  cursor loop
197                BEGIN
198                     LOG_MESSAGE(l_verbose,'killing related sessions : sid= ' || l_sessions(i).sid || ' serial#= ' || l_sessions(i).serial_no || ' ...');
199                       EXECUTE IMMEDIATE 'ALTER SYSTEM KILL SESSION ' || DBMS_ASSERT.ENQUOTE_LITERAL(l_sessions(i).sid || ',' || l_sessions(i).serial_no)||' IMMEDIATE';
200                EXCEPTION
201                        WHEN OTHERS THEN
202                           err := SQLCODE;
203                           IF err != -30 THEN
204                              LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: no session found; or already killed.');
205                              EXIT;
206                           END IF;
207                END;
208                COMMIT;
209                END LOOP; -- end cursor loop
210  
211              EXCEPTION
212                  WHEN OTHERS THEN
213                    err := SQLCODE;
214                    IF err != -30 THEN
215                      LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: no session found; or already killed.');
216                      EXIT;
217                    END IF;
218              END;
219  
220              IF SQL%NOTFOUND THEN
221                 LOG_MESSAGE(l_verbose,'found [sql%notfound]: no session found; or already killed.');
222                 EXIT;
223              END IF;
224  
225            COMMIT;
226  
227            END LOOP;  -- end session killing loop
228            LOG_MESSAGE(l_verbose,' Dropping user : ' || l_username || '...');
229  
230            EXECUTE IMMEDIATE 'drop user ' || l_username || ' cascade';
231            exit;
232            EXCEPTION
233              WHEN NO_DATA_FOUND THEN
234                LOG_MESSAGE(l_verbose,'found [no_data_found]: no user/corresponding sessions found related to DB Control');
235                 EXIT;
236              WHEN OTHERS THEN
237                err := SQLCODE;
238                IF err = -1918 THEN
239                 LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: no DB Control user/corresponding sessions found related to DB Control');
240                  EXIT;
241                ELSE
242                  IF err = -1940 THEN
243                    NULL;
244                  ELSE
245                    -- keep count of try to drop EM related user and sessions
246                    -- give up after 50 try
247  
248                    c := c+1;
249                    IF c > 50 THEN
250                       RAISE;
251                    END IF;
252                  END IF;
253                END IF;
254          END;
255          END LOOP; -- end part main loop
256         END;
257         ELSE
258                 LOG_MESSAGE(l_verbose,'SYSMAN IS ALREADY DROPPED');
259         END IF;
260     END;
261  
262     BEGIN
263         -- Now, drop the SYSMAN user
264         LOG_MESSAGE(l_verbose,'Finished phase 1');
265         LOG_MESSAGE(l_verbose,'Starting phase 2 : Dropping SYSMAN schema ...');
266  
267         c := 0;
268         -- validate user exists
269         select count(1) into l_sysman_user from all_users where username='SYSMAN';
270         IF (l_sysman_user > 0 ) THEN
271         BEGIN
272  
273             BEGIN
274               --  SELECT username
275               --   INTO l_username
276               --   FROM dba_users
277               --   WHERE username = 'SYSMAN';
278                  -- l_user_name := 'SYSMAN';
279                  -- l_username = DBMS_ASSERT.ENQUOTE_NAME(l_user_name);
280                  EXECUTE IMMEDIATE 'ALTER USER SYSMAN ACCOUNT LOCK' ;
281             EXCEPTION
282                  WHEN NO_DATA_FOUND THEN
283                      LOG_MESSAGE(l_verbose,'SYSMAN IS ALREADY DROPPED');
284                  -- THEN RETURN ;
285             END ;
286  
287  
288             BEGIN
289                 LOOP  -- main loop
290                     BEGIN
291                         FOR cnt in 1 .. 150 LOOP -- session kill loop
292                             BEGIN
293                                 FOR crec in (SELECT sid, serial#
294                                     FROM gv$session
295                                       WHERE (username='SYSMAN' OR
296                                          schemaname='SYSMAN')
297                                       AND status != 'KILLED')
298                                 LOOP   --cursor loop
299                                     BEGIN
300                                         LOG_MESSAGE(l_verbose,'killing related sessions : sid= ' || crec.sid || ' serial#= ' || crec.serial#  || ' ...');
301                                         EXECUTE IMMEDIATE 'ALTER SYSTEM KILL SESSION ' ||
302                                           DBMS_ASSERT.ENQUOTE_LITERAL(crec.sid || ',' || crec.serial#)|| ' IMMEDIATE';
303                                     EXCEPTION
304                                     WHEN OTHERS THEN
305                                         err := SQLCODE;
306                                         IF err != -30 THEN
307                                             LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: SYSMAN related sessions are already killed; no session found');
308                                             EXIT;
309                                         END IF;
310                                    END;
311                                    COMMIT;
312                                 END LOOP;  -- cursor loop ends
313                             EXCEPTION
314                                WHEN OTHERS THEN
315                                   err := SQLCODE;
316                                   IF err != -30 THEN
317                                       LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: SYSMAN related sessions are already killed; no session found');
318                                       EXIT;
319                                   END IF;
320                             END;
321                             IF SQL%NOTFOUND THEN
322                                  LOG_MESSAGE(l_verbose,'found [sql%notfound]: SYSMAN related sessions are already killed; no session found');
323                                  EXIT;
324                            END IF;
325                            COMMIT;
326                         END LOOP;  -- end of session kill loop
327  
328                         -- END;
329                         LOG_MESSAGE(l_verbose,'dropping user :  ' || l_user_name || '...');
330                         execute immediate 'drop user SYSMAN cascade';
331                         set_job_process_count(l_job_process_count) ;
332                         exit;
333  
334                         -- >> START - Dropping the Tablespaces
335                         LOG_MESSAGE(l_verbose,'Finished phase 2');
336                         LOG_MESSAGE(l_verbose,'Starting phase 3 : Dropping Oracle Enterprise Manager related tablespaces ...');
337  
338                         LOG_MESSAGE(l_verbose,'No seperate TABLESPACES Exist for EM;  all in SYSAUX; no action taken');
339                         -- >> END - Dropping the Tablespaces
340  
341                     EXCEPTION
342                        WHEN NO_DATA_FOUND THEN
343                            LOG_MESSAGE(l_verbose,'found [ no_data_found]: no sysman/corresponding sessions');
344                            EXIT;
345                        WHEN OTHERS THEN
346                        err := SQLCODE;
347                        IF err = -1918 THEN
348                            LOG_MESSAGE(l_verbose,'found [sqlcode:1918]: no sysman/corresponding sessions');
349                            EXIT;
350                        ELSIF err = -1940 THEN
351                                NULL;
352                        ELSE
353                            LOG_MESSAGE(l_verbose,'found [sqlcode:'||err||']: no sysman/corresponding sessions');
354                            c := c+1;
355                            IF c > 50 THEN
356                                RAISE;
357                            END IF;
358                        END IF;
359                     END;
360                 END LOOP;  -- end of main loop
361             END;
362             LOG_MESSAGE(l_verbose,'SYSMAN dropped');
363             commit;
364         END;
365      ELSE
366        LOG_MESSAGE(l_verbose,'SYSMAN is already dropped');
367      END IF;
368      EXCEPTION
369          WHEN OTHERS THEN
370          set_job_process_count(l_job_process_count) ;
371          RAISE ;
372      END;
373  
374  BEGIN
375  
376      -- Drop basic roles.
377      LOG_MESSAGE(l_verbose,'Finished phase 3');
378      LOG_MESSAGE(l_verbose,'Starting phase 4 : Dropping Oracle Enterprise Manager related MGMT_USER role ...');
379  
380      BEGIN
381        execute immediate 'drop role MGMT_USER';
382      EXCEPTION
383            WHEN OTHERS THEN
384            LOG_MESSAGE(l_verbose,'Role MGMT_USER already dropped');
385      END;
386      --
387      -- Drop the following synonyms related to REPOS Schema
388      --
389      LOG_MESSAGE(l_verbose,'Finished phase 4');
390      LOG_MESSAGE(l_verbose,'Starting phase 5 : Dropping Oracle Enterprise Manager related public synonyms ...');
391  
392  
393      BEGIN
394        FOR crec in (SELECT synonym_name,table_owner,table_name
395                     FROM dba_synonyms
396                     WHERE owner = 'PUBLIC'
397                     AND table_owner = 'SYSMAN')
398        LOOP
399            BEGIN
400                LOG_MESSAGE(l_verbose,'Dropping synonym : ' || crec.synonym_name || ' ... ');
401                EXECUTE IMMEDIATE 'DROP PUBLIC SYNONYM ' || DBMS_ASSERT.SIMPLE_SQL_NAME(crec.synonym_name);
402  
403            EXCEPTION
404                when others then
405                LOG_MESSAGE(l_verbose,'Public synonym ' || crec.synonym_name ||
406                                     ' cannot be dropped');
407                -- continue dropping other synonyms.
408            END;
409        END LOOP;
410      END;
411  
412      BEGIN
413        LOG_MESSAGE(l_verbose,'Finished phase 5');
414        LOG_MESSAGE(l_verbose,'Starting phase 6 : Dropping Oracle Enterprise Manager related other roles ...');
415        FOR crec in (select role from sys.dba_roles where role like 'MGMT_%')
416        LOOP
417          LOG_MESSAGE(l_verbose,'Dropping role: ' || crec.role ||' ...');
418          execute immediate 'drop role ' || DBMS_ASSERT.SIMPLE_SQL_NAME(crec.role);
419          commit;
420        END LOOP;
421      EXCEPTION
422          when NO_DATA_FOUND THEN
423            LOG_MESSAGE(l_verbose,'Roles like MGMT% do not exist');
424          WHEN OTHERS THEN
425            err := SQLCODE;
426            LOG_MESSAGE(l_verbose,'found [sqlcode: '||SQLCODE||']: no MGMT% roles to drop');
427      END;
428  
429      -- lock DBSNMP user
430      BEGIN
431          BEGIN
432             LOG_MESSAGE(l_verbose,'Process DBSNMP user');
433             select count(1) into l_open_acc  from DBA_USERS where USERNAME ='DBSNMP' and ACCOUNT_STATUS='OPEN';
434          EXCEPTION
435             when NO_DATA_FOUND THEN
436                LOG_MESSAGE(l_verbose,'User DBSNMP does not exist');
437             WHEN OTHERS THEN
438                  err := SQLCODE;
439                  LOG_MESSAGE(l_verbose,'found [sqlcode: '||SQLCODE||']: while checking DBSNMP user status');
440  
441          END;
442  
443          IF (l_open_acc > 0 ) THEN
444              BEGIN
445                  execute immediate 'ALTER USER DBSNMP PASSWORD EXPIRE';
446                   LOG_MESSAGE(l_verbose,'DBSNMP user password is made expired');
447              EXCEPTION
448                  WHEN OTHERS THEN
449                      err := SQLCODE;
450                      LOG_MESSAGE(l_verbose,'found [sqlcode: '||SQLCODE||']: while expiring DBSNMP user password');
451              END;
452  
453              BEGIN
454                  execute immediate 'ALTER USER DBSNMP ACCOUNT LOCK';
455                   LOG_MESSAGE(l_verbose,'User DBSNMP is locked');
456              EXCEPTION
457                  WHEN OTHERS THEN
458                      err := SQLCODE;
459                      LOG_MESSAGE(l_verbose,'found [sqlcode: '||SQLCODE||']: while locking DBSNMP user');
460              END;
461  
462          END IF;
463          LOG_MESSAGE(l_verbose,'Done processing DBSNMP user');
464      END;
465  
466      LOG_MESSAGE(l_verbose,'Finished phase 6');
467      LOG_MESSAGE(l_verbose,'The Oracle Enterprise Manager related schemas and objects are dropped.');
468      LOG_MESSAGE(l_verbose,'Do the manual steps to studown the DB Control if not done before running this script and then delete the DB Control configuration files');
469      commit;
470  END;
471  END;
472  /
old  70:     IF (upper('&LOGGING') = 'VERBOSE')
new  70:     IF (upper('VERBOSE') = 'VERBOSE')
This script will drop the Oracle Enterprise Manager related schemas and objects.
This script might take few minutes to complete; it has 6 phases to complete the
process.
The script may take longer if you have SYSMAN and related sessions are active
from Oracle Enterprise Manager(OEM) application.
Recommendations:
You are recommended to shutdown DB Control application immediately before
running this
OEM repository removal script.
To shutdown DB Control application, you need to run: emctl stop dbconsole
Steps to be performed manually (after this script is run):
Please note that you need to remove the DB Control Configuration Files
manually to remove DB Control completly; remove the following
directories from your filesystem:
<ORACLE_HOME>/<hostname_sid>
<ORACLE_HOME>/oc4j/j2ee/OC4J_DBConsole_<hostname>_<sid>
If the dbcontrol is upgraded from lower version, for example, from 10.2.0.3 to
10.2.0.4,
then the following directory also needs to be removed from the file system.
<ORACLE_HOME>/<hostname_sid>.upgrade
<ORACLE_HOME>/oc4j/j2ee/OC4J_DBConsole_<hostname>_<sid>.upgrade
On Microsoft platforms, also delete the DB Console service, generally with name
OracleDBConsole<sid>
Starting phase 1 : Dropping AQ related objests, EM jobs and all Oracle
Enterprise Manager related schemas; except SYSMAN ...
dropping AQ related objests from SYSMAN ...
saved job_queue_process=0, set to 0, now removing Oracle EM jobs ...
finding users who needs to be dropped ...
found user name: MGMT_VIEW
found [sql%notfound]: no session found; or already killed.
Dropping user : "MGMT_VIEW"...
Finished phase 1
Starting phase 2 : Dropping SYSMAN schema ...
found [sql%notfound]: SYSMAN related sessions are already killed; no session
found
dropping user :  MGMT_VIEW...
SYSMAN dropped
Finished phase 3
Starting phase 4 : Dropping Oracle Enterprise Manager related MGMT_USER role ...
Finished phase 4
Starting phase 5 : Dropping Oracle Enterprise Manager related public synonyms
...
Dropping synonym : MGMT_TARGET_BLACKOUTS ...
Dropping synonym : MGMT$E2E_1DAY ...
Dropping synonym : MGMT$E2E_HOURLY ...
Dropping synonym : MGMT$E2E_RAW ...
Dropping synonym : MGMT$TXN_PERF_RAW ...
Dropping synonym : MGMT$TXN_PERF_HOUR ...
Dropping synonym : MGMT$TXN_PERF_DAY ...
Dropping synonym : MGMT$STEPS ...
Dropping synonym : MGMT$STEP_GROUPS ...
Dropping synonym : MGMT$STEP_METRICS_RAW ...
Dropping synonym : MGMT$GRP_METRICS_RAW ...
Dropping synonym : MGMT$STEP_METRICS_HOURLY ...
Dropping synonym : MGMT$GRP_METRICS_HOURLY ...
Dropping synonym : MGMT$STEP_METRICS_DAILY ...
Dropping synonym : MGMT$GRP_METRICS_DAILY ...
Dropping synonym : MGMT_AVAILABILITY ...
Dropping synonym : MGMT_CURRENT_AVAILABILITY ...
Dropping synonym : MGMT_SEVERITY_OBJ ...
Dropping synonym : MGMT_SEVERITY_ARRAY ...
Dropping synonym : MGMT_GUID_OBJ ...
Dropping synonym : MGMT_GUID_ARRAY ...
Dropping synonym : SMP_EMD_AVAIL_OBJ ...
Dropping synonym : SMP_EMD_TARGET_OBJ ...
Dropping synonym : SMP_EMD_TARGET_OBJ_ARRAY ...
Dropping synonym : SMP_EMD_DELETE_REC_ARRAY ...
Dropping synonym : MGMT_METRICS ...
Dropping synonym : MGMT_TARGETS ...
Dropping synonym : MGMT_TYPE_PROPERTIES ...
Dropping synonym : MGMT_TARGET_PROPERTIES ...
Dropping synonym : MGMT_METRICS_RAW ...
Dropping synonym : MGMT_CURRENT_METRICS ...
Dropping synonym : MGMT_STRING_METRIC_HISTORY ...
Dropping synonym : MGMT_LONG_TEXT ...
Dropping synonym : MGMT_METRICS_COMPOSITE_KEYS ...
Dropping synonym : MGMT_METRICS_1HOUR ...
Dropping synonym : MGMT_METRICS_1DAY ...
Dropping synonym : MGMT_METRIC_ERRORS ...
Dropping synonym : MGMT_CURRENT_METRIC_ERRORS ...
Dropping synonym : EMD_MNTR ...
Dropping synonym : MGMT_METRIC_COLLECTIONS ...
Dropping synonym : MGMT_COLLECTION_PROPERTIES ...
Dropping synonym : MGMT_METRIC_THRESHOLDS ...
Dropping synonym : SMP_EMD_NVPAIR ...
Dropping synonym : SMP_EMD_NVPAIR_ARRAY ...
Dropping synonym : SMP_EMD_STRING_ARRAY ...
Dropping synonym : SMP_EMD_STRING_ARRAY_ARRAY ...
Dropping synonym : SMP_EMD_INTEGER_ARRAY ...
Dropping synonym : SMP_EMD_INTEGER_ARRAY_ARRAY ...
Dropping synonym : MGMT_DELTA_IDS ...
Dropping synonym : MGMT_DELTA_ID_VALUES ...
Dropping synonym : MGMT_DELTA_ENTRY ...
Dropping synonym : MGMT_DELTA_ENTRY_VALUES ...
Dropping synonym : MGMT_DELTA_VALUE ...
Dropping synonym : MGMT_DELTA_VALUES ...
Dropping synonym : MGMT_NAME_VALUE ...
Dropping synonym : MGMT_NAME_VALUES ...
Dropping synonym : ECM_UTIL ...
Dropping synonym : MGMT_DELTA ...
Dropping synonym : MGMT_TARGET_MEMBERSHIPS ...
Dropping synonym : MGMT_JOB ...
Dropping synonym : MGMT_JOB_PARAMETER ...
Dropping synonym : MGMT_JOB_TARGET ...
Dropping synonym : MGMT_JOB_SCHEDULE ...
Dropping synonym : MGMT_JOB_EXECPLAN ...
Dropping synonym : MGMT_JOB_EXEC_SUMMARY ...
Dropping synonym : MGMT_JOB_OUTPUT ...
Dropping synonym : MGMT_JOB_EXECUTION ...
Dropping synonym : MGMT_LOG ...
Dropping synonym : MGMT_ADMIN ...
Dropping synonym : MGMT_GLOBAL ...
Dropping synonym : MGMT_TARGET ...
Dropping synonym : MGMT_CREDENTIAL ...
Dropping synonym : MGMT_JOBS ...
Dropping synonym : MGMT_PREFERENCES ...
Dropping synonym : MGMT_USER ...
Dropping synonym : MGMT_SEVERITY ...
Dropping synonym : MGMT_CURRENT_SEVERITY ...
Dropping synonym : MGMT_PAF_PROCS_LATEST ...
Dropping synonym : MGMT_PAF_JOBS ...
Dropping synonym : MGMT_PAF$PROCEDURES ...
Dropping synonym : MGMT_PAF$INSTANCES ...
Dropping synonym : MGMT_PAF$STATES ...
Dropping synonym : MGMT_PAF$APPLICATIONS ...
Dropping synonym : SETEMVIEWUSERCONTEXT ...
Dropping synonym : MGMT_VIEW_UTIL ...
Dropping synonym : MGMT_MESSAGES ...
Dropping synonym : MGMT$ALERT_ANNOTATIONS ...
Dropping synonym : MGMT$ALERT_CURRENT ...
Dropping synonym : MGMT$ALERT_HISTORY ...
Dropping synonym : MGMT$ALERT_NOTIF_LOG ...
Dropping synonym : MGMT$APPLIED_PATCHES ...
Dropping synonym : MGMT$APPLIED_PATCHSETS ...
Dropping synonym : MGMT$APPL_PATCH_AND_PATCHSET ...
Dropping synonym : MGMT$AUDIT_LOG ...
Dropping synonym : MGMT$AVAILABILITY_CURRENT ...
Dropping synonym : MGMT$AVAILABILITY_HISTORY ...
Dropping synonym : MGMT$BLACKOUTS ...
Dropping synonym : MGMT$BLACKOUT_HISTORY ...
Dropping synonym : MGMT$CLUSTER_INTERCONNECTS ...
Dropping synonym : MGMT$CPF_ADVISORY_INFO ...
Dropping synonym : MGMT$CPF_HOMES_INFO ...
Dropping synonym : MGMT$CPF_PATCH_DATA ...
Dropping synonym : MGMT$CPF_PATCH_INFO ...
Dropping synonym : MGMT$CSA_CLIENTS ...
Dropping synonym : MGMT$CSA_CLIENT_RULE_VIOLS ...
Dropping synonym : MGMT$CSA_COLLECTIONS ...
Dropping synonym : MGMT$CSA_FAILED ...
Dropping synonym : MGMT$CSA_HOST_COOKIES ...
Dropping synonym : MGMT$CSA_HOST_CPUS ...
Dropping synonym : MGMT$CSA_HOST_CUSTOM ...
Dropping synonym : MGMT$CSA_HOST_IOCARDS ...
Dropping synonym : MGMT$CSA_HOST_NICS ...
Dropping synonym : MGMT$CSA_HOST_OS_COMPONENTS ...
Dropping synonym : MGMT$CSA_HOST_OS_FILESYSTEMS ...
Dropping synonym : MGMT$CSA_HOST_OS_PROPERTIES ...
Dropping synonym : MGMT$CSA_HOST_RULES ...
Dropping synonym : MGMT$CSA_HOST_SW ...
Dropping synonym : MGMT$CSM_DOMAIN_DAILY ...
Dropping synonym : MGMT$CSM_DOMAIN_DIST_DAILY ...
Dropping synonym : MGMT$CSM_DOMAIN_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_DOMAIN_HOURLY ...
Dropping synonym : MGMT$CSM_IP_DAILY ...
Dropping synonym : MGMT$CSM_IP_DIST_DAILY ...
Dropping synonym : MGMT$CSM_IP_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_IP_HOURLY ...
Dropping synonym : MGMT$CSM_METRIC_DETAILS ...
Dropping synonym : MGMT$CSM_MT_DSR_DAILY ...
Dropping synonym : MGMT$CSM_MT_DSR_DIST_DAILY ...
Dropping synonym : MGMT$CSM_MT_DSR_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_MT_DSR_HOURLY ...
Dropping synonym : MGMT$CSM_MT_IP_DAILY ...
Dropping synonym : MGMT$CSM_MT_IP_DIST_DAILY ...
Dropping synonym : MGMT$CSM_MT_IP_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_MT_IP_HOURLY ...
Dropping synonym : MGMT$CSM_MT_METRIC_DETAILS ...
Dropping synonym : MGMT$CSM_MT_URL_DAILY ...
Dropping synonym : MGMT$CSM_MT_URL_DIST_DAILY ...
Dropping synonym : MGMT$CSM_MT_URL_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_MT_URL_HOURLY ...
Dropping synonym : MGMT$CSM_REGION ...
Dropping synonym : MGMT$CSM_REGION_DAILY ...
Dropping synonym : MGMT$CSM_REGION_DIST_DAILY ...
Dropping synonym : MGMT$CSM_REGION_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_REGION_HOURLY ...
Dropping synonym : MGMT$CSM_SUBNET_DAILY ...
Dropping synonym : MGMT$CSM_SUBNET_DIST_DAILY ...
Dropping synonym : MGMT$CSM_SUBNET_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_SUBNET_HOURLY ...
Dropping synonym : MGMT$CSM_URL_DAILY ...
Dropping synonym : MGMT$CSM_URL_DIST_DAILY ...
Dropping synonym : MGMT$CSM_URL_DIST_HOURLY ...
Dropping synonym : MGMT$CSM_URL_HOURLY ...
Dropping synonym : MGMT$CSM_WATCHLIST ...
Dropping synonym : MGMT$CS_CONFIG_STANDARDS ...
Dropping synonym : MGMT$CS_EVAL_SUMMARY_RULE ...
Dropping synonym : MGMT$CS_EVAL_SUMMARY_STANDARD ...
Dropping synonym : MGMT$DB_CONTROLFILES ...
Dropping synonym : MGMT$DB_CONTROLFILES_ALL ...
Dropping synonym : MGMT$DB_DATAFILES ...
Dropping synonym : MGMT$DB_DATAFILES_ALL ...
Dropping synonym : MGMT$DB_DBNINSTANCEINFO ...
Dropping synonym : MGMT$DB_DBNINSTANCEINFO_ALL ...
Dropping synonym : MGMT$DB_FEATUREUSAGE ...
Dropping synonym : MGMT$DB_INIT_PARAMS ...
Dropping synonym : MGMT$DB_INIT_PARAMS_ALL ...
Dropping synonym : MGMT$DB_LICENSE ...
Dropping synonym : MGMT$DB_LICENSE_ALL ...
Dropping synonym : MGMT$DB_OPTIONS ...
Dropping synonym : MGMT$DB_OPTIONS_ALL ...
Dropping synonym : MGMT$DB_REDOLOGS ...
Dropping synonym : MGMT$DB_REDOLOGS_ALL ...
Dropping synonym : MGMT$DB_ROLLBACK_SEGS ...
Dropping synonym : MGMT$DB_ROLLBACK_SEGS_ALL ...
Dropping synonym : MGMT$DB_SGA ...
Dropping synonym : MGMT$DB_SGA_ALL ...
Dropping synonym : MGMT$DB_TABLESPACES ...
Dropping synonym : MGMT$DB_TABLESPACES_ALL ...
Dropping synonym : MGMT$DELTA_COMPONENTS ...
Dropping synonym : MGMT$DELTA_COMPONENT_DETAILS ...
Dropping synonym : MGMT$DELTA_FS_MOUNT ...
Dropping synonym : MGMT$DELTA_HARDWARE ...
Dropping synonym : MGMT$DELTA_HOST_CONFIG ...
Dropping synonym : MGMT$DELTA_INIT ...
Dropping synonym : MGMT$DELTA_ONEOFF_PATCHES ...
Dropping synonym : MGMT$DELTA_ORACLE_HOME ...
Dropping synonym : MGMT$DELTA_OS_COMPONENTS ...
Dropping synonym : MGMT$DELTA_OS_COMP_DETAILS ...
Dropping synonym : MGMT$DELTA_OS_KERNEL_PARAMS ...
Dropping synonym : MGMT$DELTA_PATCHSETS ...
Dropping synonym : MGMT$DELTA_PATCHSET_DETAILS ...
Dropping synonym : MGMT$DELTA_VENDOR_SW ...
Dropping synonym : MGMT$DELTA_VIEW ...
Dropping synonym : MGMT$DELTA_VIEW_DETAILS ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY1 ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY2 ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY3 ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY4 ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY5 ...
Dropping synonym : MGMT$ECM_CONFIG_HISTORY_KEY6 ...
Dropping synonym : MGMT$ECM_CURRENT_SNAPSHOTS ...
Dropping synonym : MGMT$ECM_VISIBLE_SNAPSHOTS ...
Dropping synonym : MGMT$EM_HOMES_PLATFORM ...
Dropping synonym : MGMT$ESA_ALL_PRIVS_REPORT ...
Dropping synonym : MGMT$ESA_ANY_DICT_REPORT ...
Dropping synonym : MGMT$ESA_ANY_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_AUDIT_SYSTEM_REPORT ...
Dropping synonym : MGMT$ESA_BECOME_USER_REPORT ...
Dropping synonym : MGMT$ESA_CATALOG_REPORT ...
Dropping synonym : MGMT$ESA_CONN_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_CREATE_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_DBA_GROUP_REPORT ...
Dropping synonym : MGMT$ESA_DBA_ROLE_REPORT ...
Dropping synonym : MGMT$ESA_DIRECT_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_EXMPT_ACCESS_REPORT ...
Dropping synonym : MGMT$ESA_KEY_OBJECTS_REPORT ...
Dropping synonym : MGMT$ESA_OH_OWNERSHIP_REPORT ...
Dropping synonym : MGMT$ESA_OH_PERMISSION_REPORT ...
Dropping synonym : MGMT$ESA_POWER_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_PUB_PRIV_REPORT ...
Dropping synonym : MGMT$ESA_SYS_PUB_PKG_REPORT ...
Dropping synonym : MGMT$ESA_TABSP_OWNERS_REPORT ...
Dropping synonym : MGMT$ESA_TRC_AUD_PERM_REPORT ...
Dropping synonym : MGMT$ESA_TRC_AUD_PERM_REP_NT ...
Dropping synonym : MGMT$ESA_WITH_ADMIN_REPORT ...
Dropping synonym : MGMT$ESA_WITH_GRANT_REPORT ...
Dropping synonym : MGMT$GROUP_DERIVED_MEMBERSHIPS ...
Dropping synonym : MGMT$GROUP_FLAT_MEMBERSHIPS ...
Dropping synonym : MGMT$GROUP_MEMBERS ...
Dropping synonym : MGMT$HA_BACKUP ...
Dropping synonym : MGMT$HA_FILES ...
Dropping synonym : MGMT$HA_FILES_ALL ...
Dropping synonym : MGMT$HA_INFO ...
Dropping synonym : MGMT$HA_INFO_ALL ...
Dropping synonym : MGMT$HA_INIT_PARAMS ...
Dropping synonym : MGMT$HA_INIT_PARAMS_ALL ...
Dropping synonym : MGMT$HA_MTTR ...
Dropping synonym : MGMT$HA_RMAN_CONFIG ...
Dropping synonym : MGMT$HA_RMAN_CONFIG_ALL ...
Dropping synonym : MGMT$HOMES_AFFECTED ...
Dropping synonym : MGMT$HOSTPATCH_GROUPS ...
Dropping synonym : MGMT$HOSTPATCH_GRP_COMPL_HIST ...
Dropping synonym : MGMT$HOSTPATCH_HOSTS ...
Dropping synonym : MGMT$HOSTPATCH_HOST_COMPL ...
Dropping synonym : MGMT$HW_NIC ...
Dropping synonym : MGMT$INTERFACE_STATS ...
Dropping synonym : MGMT$JOBS ...
Dropping synonym : MGMT$JOB_ANNOTATIONS ...
Dropping synonym : MGMT$JOB_EXECUTION_HISTORY ...
Dropping synonym : MGMT$JOB_NOTIFICATION_LOG ...
Dropping synonym : MGMT$JOB_STEP_HISTORY ...
Dropping synonym : MGMT$JOB_TARGETS ...
Dropping synonym : MGMT$MESSAGES ...
Dropping synonym : MGMT$METRIC_CATEGORIES ...
Dropping synonym : MGMT$METRIC_COLLECTION ...
Dropping synonym : MGMT$METRIC_CURRENT ...
Dropping synonym : MGMT$METRIC_DAILY ...
Dropping synonym : MGMT$METRIC_DETAILS ...
Dropping synonym : MGMT$METRIC_ERROR_CURRENT ...
Dropping synonym : MGMT$METRIC_ERROR_HISTORY ...
Dropping synonym : MGMT$METRIC_HOURLY ...
Dropping synonym : MGMT$MISSING_TARGETS ...
Dropping synonym : MGMT$MISSING_TARGETS_IN_GROUPS ...
Dropping synonym : MGMT$ORACLE_SW_ENT_INSTALL ...
Dropping synonym : MGMT$ORACLE_SW_ENT_TARGETS ...
Dropping synonym : MGMT$ORACLE_SW_GRP_INSTALL ...
Dropping synonym : MGMT$ORACLE_SW_GRP_TARGETS ...
Dropping synonym : MGMT$OS_COMPONENTS ...
Dropping synonym : MGMT$OS_FS_MOUNT ...
Dropping synonym : MGMT$OS_HW_SUMMARY ...
Dropping synonym : MGMT$OS_KERNEL_PARAMS ...
Dropping synonym : MGMT$OS_PATCHES ...
Dropping synonym : MGMT$OS_PROPERTIES ...
Dropping synonym : MGMT$OS_SUMMARY ...
Dropping synonym : MGMT$PATCH_ADVISORIES ...
Dropping synonym : MGMT$POLICIES ...
Dropping synonym : MGMT$POLICY_PARAMETERS ...
Dropping synonym : MGMT$POLICY_VIOLATION_CONTEXT ...
Dropping synonym : MGMT$POLICY_VIOLATION_CTXT ...
Dropping synonym : MGMT$POLICY_VIOLATION_CURRENT ...
Dropping synonym : MGMT$POLICY_VIOLATION_HISTORY ...
Dropping synonym : MGMT$POLICY_VIOL_ANNOTATIONS ...
Dropping synonym : MGMT$POLICY_VIOL_NOTIF_LOG ...
Dropping synonym : MGMT$RACDB_INTERCONNECTS ...
Dropping synonym : MGMT$SOFTWARE_COMPONENTS ...
Dropping synonym : MGMT$SOFTWARE_COMPONENT_ONEOFF ...
Dropping synonym : MGMT$SOFTWARE_COMP_PATCHSET ...
Dropping synonym : MGMT$SOFTWARE_DEPENDENCIES ...
Dropping synonym : MGMT$SOFTWARE_HOMES ...
Dropping synonym : MGMT$SOFTWARE_HOME_PROPERTIES ...
Dropping synonym : MGMT$SOFTWARE_ONEOFF_PATCHES ...
Dropping synonym : MGMT$SOFTWARE_OTHERS ...
Dropping synonym : MGMT$SOFTWARE_PATCHES_IN_HOMES ...
Dropping synonym : MGMT$SOFTWARE_PATCHSETS ...
Dropping synonym : MGMT$STORAGE_REPORT_DATA ...
Dropping synonym : MGMT$STORAGE_REPORT_DISK ...
Dropping synonym : MGMT$STORAGE_REPORT_ISSUES ...
Dropping synonym : MGMT$STORAGE_REPORT_KEYS ...
Dropping synonym : MGMT$STORAGE_REPORT_LOCALFS ...
Dropping synonym : MGMT$STORAGE_REPORT_NFS ...
Dropping synonym : MGMT$STORAGE_REPORT_PATHS ...
Dropping synonym : MGMT$STORAGE_REPORT_VOLUME ...
Dropping synonym : MGMT$TARGET ...
Dropping synonym : MGMT$TARGET_ASSOCIATIONS ...
Dropping synonym : MGMT$TARGET_COMPONENTS ...
Dropping synonym : MGMT$TARGET_COMPOSITE ...
Dropping synonym : MGMT$TARGET_FLAT_MEMBERS ...
Dropping synonym : MGMT$TARGET_MEMBERS ...
Dropping synonym : MGMT$TARGET_METRIC_COLLECTIONS ...
Dropping synonym : MGMT$TARGET_METRIC_SETTINGS ...
Dropping synonym : MGMT$TARGET_POLICIES ...
Dropping synonym : MGMT$TARGET_POLICY_EVAL_SUMM ...
Dropping synonym : MGMT$TARGET_POLICY_SETTINGS ...
Dropping synonym : MGMT$TARGET_PROPERTIES ...
Dropping synonym : MGMT$TARGET_TYPE ...
Dropping synonym : MGMT$TARGET_TYPE_DEF ...
Dropping synonym : MGMT$TARGET_TYPE_PROPERTIES ...
Dropping synonym : MGMT$TEMPLATES ...
Dropping synonym : MGMT$TEMPLATE_METRICCOLLECTION ...
Dropping synonym : MGMT$TEMPLATE_METRIC_SETTINGS ...
Dropping synonym : MGMT$TEMPLATE_POLICY_SETTINGS ...
Dropping synonym : MGMT_IP_TGT_GUID_ARRAY ...
Dropping synonym : MGMT$DELTA_TABLESPACES ...
Finished phase 5
Starting phase 6 : Dropping Oracle Enterprise Manager related other roles ...
Process DBSNMP user
DBSNMP user password is made expired
User DBSNMP is locked
Done processing DBSNMP user
Finished phase 6
The Oracle Enterprise Manager related schemas and objects are dropped.
Do the manual steps to studown the DB Control if not done before running this
script and then delete the DB Control configuration files

PL/SQL procedure successfully completed.

7)	Çalışan backup job ı var mı kontrol edilir.
SQL> SELECT * FROM v$backup WHERE status != 'NOT ACTIVE';  

no rows selected

8)	Recyclebin purge edilir.
SQL> PURGE DBA_RECYCLEBIN;

DBA Recyclebin purged.

9)	Dictionary stats toplanır.
SQL>  EXEC DBMS_STATS.GATHER_DICTIONARY_STATS;

PL/SQL procedure successfully completed.

10)	Timezone kontrol edilir.
SQL> select * from v$timezone_file;

FILENAME                VERSION
-------------------- ----------
timezlrg_14.dat              14

11)	Preupgrade çalıştırılır. 
select *
from  apex_application_page_items;
/u02/app/oracle/product/11.2.0/dbhome_1/jdk/bin/java -jar /u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/preupgrade.jar FILE TEXT DIR /tmp

==============
BEFORE UPGRADE
==============

  REQUIRED ACTIONS
  ================
  1.  Set the value of JOB_QUEUE_PROCESSES to a non-zero value, or remove the
      setting entirely and accept the Oracle default.

      The database has JOB_QUEUE_PROCESSES=0.

      Starting with Oracle Database 11.2, setting JOB_QUEUE_PROCESSES=0 will
      disable job execution via DBMS_JOBS and DBMS_SCHEDULER.

  2.  Contact Oracle Support for instructions on how to resolve this error.
      ERROR: ORA-29548 ORA-29548: Java system class reported: could not
      identify release specified in classes.bin

      There is a problem with the JAVAVM component and database upgrade cannot
      be performed until it is corrected.

      JAVAVM component must be functioning properly before database upgrade

Böyle bir hata alınırsa Patch 23177551 - Oracle JavaVM Component 11.2.0.4.160719 Database PSU (Jul2016) uygulanır ve job_queue process 1000 e set edilir.

SQL> select dbms_java.longname('TEST') from dual;
select dbms_java.longname('TEST') from dual
       *
ERROR at line 1:
ORA-29548: Java system class reported: could not identify release specified in
classes.bin
ORA-06512: at "SYS.DBMS_JAVA", line 139


cd $ORACLE_HOME/sqlpatch/23177551
SQL> shu immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup upgrade
ORACLE instance started.

Total System Global Area 1.0689E+11 bytes
Fixed Size                  2265864 bytes
Variable Size            6.3888E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers               55242752 bytes
Database mounted.
Database opened.
SQL> @postinstall.sql

SQL> shutdown
SQL> startup


alter system set job_quue_process=1000;

Daha sonra preupgrade tekrar çalıştırılır. RECOMMENDED ACTIONS altındaki adımlar uygulanır.

[oracle@exa0101vm01 ~]$ /u02/app/oracle/product/11.2.0/dbhome_1/jdk/bin/java -jar /u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/preupgrade.jar FILE TEXT DIR /tmp
==================
PREUPGRADE SUMMARY
==================
  /tmp/preupgrade.log
  /tmp/preupgrade_fixups.sql
  /tmp/postupgrade_fixups.sql

Execute fixup scripts as indicated below:

Before upgrade:

Log into the database and execute the preupgrade fixups
@/tmp/preupgrade_fixups.sql

After the upgrade:

Log into the database and execute the postupgrade fixups
@/tmp/postupgrade_fixups.sql

Preupgrade complete: 2020-04-02T16:56:17


Report generated by Oracle Database Pre-Upgrade Information Tool Version
19.0.0.0.0 Build: 1 on 2020-04-02T16:56:17

Upgrade-To version: 19.0.0.0.0

=======================================
Status of the database prior to upgrade
=======================================
      Database Name:  FOTO
     Container Name:  Not Applicable in Pre-12.1 database
       Container ID:  Not Applicable in Pre-12.1 database
            Version:  11.2.0.4.0
     DB Patch Level:  No Patch Bundle applied
         Compatible:  11.2.0.4.0
          Blocksize:  8192
           Platform:  Linux x86 64-bit
      Timezone File:  14
  Database log mode:  ARCHIVELOG
           Readonly:  FALSE
            Edition:  EE

  Oracle Component                       Upgrade Action    Current Status
  ----------------                       --------------    --------------
  Oracle Server                          [to be upgraded]  VALID
  JServer JAVA Virtual Machine           [to be upgraded]  VALID
  Oracle XDK for Java                    [to be upgraded]  VALID
  Real Application Clusters              [to be upgraded]  VALID
  Oracle Workspace Manager               [to be upgraded]  VALID
  Oracle XML Database                    [to be upgraded]  VALID
  Oracle Java Packages                   [to be upgraded]  VALID
  Expression Filter                      [to be upgraded]  VALID
  Rule Manager                           [to be upgraded]  VALID

==============
BEFORE UPGRADE
==============

 REQUIRED ACTIONS
  ================
  None

  RECOMMENDED ACTIONS
  ===================
  1.  Update NUMERIC INITIALIZATION PARAMETERS to meet estimated minimums.
      This action may be done now or when starting the database in upgrade mode
      using the 19 ORACLE HOME.

       Parameter                                 Currently  19 minimum

       Parameter                                 Currently  19 minimum
       ---------                                 ---------  ------------------
      *java_pool_size                             16777216           117440512

      The database upgrade process requires certain initialization parameters
      to meet minimum values.  The Oracle upgrade process itself has minimum
      values which may be higher and are marked with an asterisk.  After
      upgrading, those asterisked parameter values may be reset if needed.

  2.  Run 11.2.0.4.0 $ORACLE_HOME/rdbms/admin/utlrp.sql to recompile invalid
      objects.  You can view the individual invalid objects with

        SET SERVEROUTPUT ON;
        EXECUTE DBMS_PREUP.INVALID_OBJECTS;

      4 objects are INVALID.

      There should be no INVALID objects in SYS/SYSTEM or user schemas before
      database upgrade.

  3.  Explicitly set RESOURCE_LIMIT to FALSE in the pfile/spfile to retain the
      previous behavior.

      the RESOURCE_LIMIT initialization parameter is not explicitly set in the
      pfile/spfile.

      The RESOURCE_LIMIT initialization parameter default value changed from
      FALSE to TRUE in 12.1.0.2 onwards.  Without an explicit setting, the
      upgrade may introduce unintented RESOURCE_LIMIT enforcement.

  4.  Backup the existing ACLs and their assignments for reference. Use the new
      DBMS_NETWORK_ACL_ADMIN interfaces and dictionary views to administer
      network privileges after upgrade.

      The database contains network ACLs with privileges that will be migrated
      to a new format in 12c.

      Network access control list (ACL) privileges in 11g will be migrated to a
      new format in 12c. As part of the migration, new DBMS_NETWORK_ACL_ADMIN
      interfaces and dictionary views are provided, and privileges in the
      existing ACLs will be converted to the new format with new ACL names. The
      old ACL names, DBMS_NETWORK_ACL_ADMIN interfaces and dictionary views may
      continue to be used but are deprecated and their use is discouraged. For
      further information, refer to My Oracle Support note number 2078710.1.

  5.  Perform one of the following:
       1) Expire user accounts that use only the old 10G password version and
      follow the procedure recommended in Oracle Database Upgrade Guide under
      the section entitled, "Checking for Accounts Using Case-Insensitive
      Password Version".
       2) Explicitly set SQLNET.ALLOWED_LOGON_VERSION_SERVER in the 19
      SQLNET.ORA to a non-Exclusive Mode value, such as "11". (This is a short
      term approach and is not recommended because it will retain known
      security risks associated with the 10G password version.)

      Your database system has at least one account with only the 10G password
      version (see the PASSWORD_VERSIONS column of DBA_USERS).

      Starting with Oracle Database release 12.2.0.1, Exclusive Mode is the new
      default password-based authentication mode. All Exclusive Mode
      login/authentication attempts will fail for preexisting user accounts
      which only have the 10G password version and neither the 11G or 12C
      password version (see DBA_USERS.PASSWORD_VERSIONS.) For more information,
      refer to "Understanding Password Case Sensitivity and Upgrades" in the
      Oracle Database Upgrade Guide.

  6.  Remove the SEC_CASE_SENSITIVE_LOGON instance initialization parameter
      setting, to configure your system to use case sensitive password
      authentication by default.

      Your database system is configured to enforce case insensitive password
      authentication (the SEC_CASE_SENSITIVE_LOGON instance initialization
      parameter setting is FALSE).

      Starting with Oracle Database release 12.2, Exclusive Mode is the default
      password-based authentication mode. Case insensitive password
      authentication is not supported in Exclusive Mode. If your system needs
      to use case insensitive password authentication, Exclusive Mode must be
      switched off prior to the upgrade. See the Network Reference Manual
      chapter about the SQLNET.ORA parameter
      SQLNET.ALLOWED_LOGON_VERSION_SERVER for more details on Exclusive Mode.

  7.  Remove Streams setup. For detailed steps, refer to the section "Removing
      an Oracle Streams Configuration" in the Oracle Streams Concepts and
      Administration Guide specific for the Oracle release from which you are
      removing. For versions pre-12.1.0.2, the procedure
      dbms_streams_adm.remove_streams_configuration must not be used as may
      lead to unwanted results. Instead, use the other procedures
      (dbms_capture_adm.drop_capture, dbms_apply_adm.drop_apply,
      dbms_streams_adm.remove_queue, etc). For 12.1.0.2 and higher, procedure
      dbms_streams_adm.remove_streams_configuration can be safely used.

      Oracle Streams feature is configured in the database.

      Oracle Streams feature is configured in the database.

      Starting with Oracle Database 19, Oracle Streams is desupported. It is
      strongly advised to remove any streams configuration manually.

  8.  If an auto-login Oracle Transparent Data Encryption (TDE) Keystore is
      correctly set up, no action needs to be taken. Otherwise, before starting
      up the database in upgrade mode in the new Oracle Database Oracle Home,
      either open the TDE Keystore, or ensure that an auto-login TDE Keystore
      is configured for the system.  If errors are seen while the database
      upgrade is running because the TDE Keystore is closed, then open the TDE
      Keystore and resume the upgrade (see "catctl.pl -R").  It may be
      necessary to open the TDE Keystore as the upgrade progresses in a non-CDB
      or CDB (e.g., in CDB$ROOT and PDB) if no auto-login TDE Keystore has been
      configured, as the upgrade process can shutdown and startup the
      database.

      The database is using TDE.  The database upgrade process can involve
      operations (certain SQL statements and/or database startups) that need to
      access the encryption key.

      If Oracle Transparent Data Encryption (TDE) is in use, the database
      system must have access to its Oracle Transparent Data Encryption Master
      Encryption Key during database upgrade.  For more information on
      configuring Transparent Data Encryption, refer to the 11.2 Oracle
      Database Advanced Security Administrator's Guide, Section 8: Securing
      Stored Data Using Transparent Data Encryption.

  9.  Please make sure that all the MVs are refreshed and sys.sumdelta$ becomes
      empty before doing upgrade, unless you have strong business reasons not
      to do so. You can use dbms_mview.refresh() to refresh the MVs except
      those stale ones  to be kept due to business need. If there are any stale
      MVs depending on changes in sys.sumdelta$, do not truncate it, because
      doing so will cause wrong results after refresh. Please refer to the
      Materialized View section in MOS Note 2380601.1 for more details.

      There are one or more materialized views in either stale or invalid
      state, or which are currently being refreshed.

      Oracle recommends that all materialized views (MV's) are refreshed before
      upgrading the database because this will clear the MV logs and the
      sumdelta$ table and may reduce the upgrade time. If you choose to not
      refresh some MVs, the change data for those MV's will be carried through
      the UPGRADE process. After UPGRADE, you can refresh the MV's and  MV
      incremental refresh should work in normal cases.


  10. (AUTOFIXUP) Gather statistics on fixed objects prior the upgrade.

      None of the fixed object tables have had stats collected.

      Gathering statistics on fixed objects, if none have been gathered yet, is
      recommended prior to upgrading.

      For information on managing optimizer statistics, refer to the 11.2.0.4
      Oracle Database Performance Tuning Guide.

  INFORMATION ONLY
  ================
  11. Consider removing the following deprecated initialization parameters.

      Parameter
      ---------
      sec_case_sensitive_logon

      These deprecated parameters probably will be obsolete in a future release.
  12. Run $ORACLE_HOME/rdbms/admin/catnoexf.sql located in the new Oracle
      Database Oracle home to remove both EXF and RUL.

      Expression Filter (EXF) or Rules Manager (RUL) exist in the database.

      Starting with Oracle Database release 12.1, the Expression Filter (EXF)
      and Database Rules Manager (RUL) features are desupported, and are
      removed during the upgrade process.  This step can be manually performed
      before the upgrade to reduce downtime.

  13. Check the Oracle Backup and Recovery User's Guide for information on how
      to manage an RMAN recovery catalog schema.

      If you are using a version of the recovery catalog schema that is older
      than that required by the RMAN client version, then you must upgrade the
      catalog schema.

      It is good practice to have the catalog schema the same or higher version
      than the RMAN client version you are using.

  ORACLE GENERATED FIXUP SCRIPT
  =============================
  All of the issues in database FOTO
  which are identified above as BEFORE UPGRADE "(AUTOFIXUP)" can be resolved by
  executing the following

    SQL>@/tmp/preupgrade_fixups.sql

=============
AFTER UPGRADE
=============
 RECOMMENDED ACTIONS
  ===================
  14. (AUTOFIXUP) If you use the -T option for the database upgrade, then run
      $ORACLE_HOME/rdbms/admin/utluptabdata.sql after the upgrade is complete,
      to VALIDATE and UPGRADE any user tables affected by changes to
      Oracle-Maintained types.

      There are user tables dependent on Oracle-Maintained object types.

      If the -T option is used to set user tablespaces to READ ONLY during the
      upgrade, user tables in those tablespaces, that are dependent on
      Oracle-Maintained types, will not be automatically upgraded. If a type is
      evolved during the upgrade, any dependent tables need to be re-validated
      and upgraded to the latest type version AFTER the database upgrade
      completes.

  15. Upgrade the database time zone file using the DBMS_DST package.

      The database is using time zone file version 14 and the target 19 release
      ships with time zone file version 32.

      Oracle recommends upgrading to the desired (latest) version of the time
      zone file.  For more information, refer to "Upgrading the Time Zone File
      and Timestamp with Time Zone Data" in the 19 Oracle Database
      Globalization Support Guide.

  16. Recreate directory objects to remove any symbolic links from directory
      paths.  To identify paths that contain symbolic links before upgrading,
      use OS commands like UNIX file or WINDOWS dir.  After upgrading, run
      $ORACLE_HOME/rdbms/admin/utldirsymlink.sql to identify directory objects
      with symbolic links in the path.
    Found 52 user directory objects to be checked: AWR_ASSESMENT,
      DIRECTORY_AMINV, DIRECTORY_AMORT, DIRECTORY_ARCHIVEUSER,
      DIRECTORY_ARCHSYS, DIRECTORY_ARIZA, DIRECTORY_ATPYTS, DIRECTORY_BANKA,
      DIRECTORY_BASE, DIRECTORY_BMF, DIRECTORY_CAPEX, DIRECTORY_CARSHARING,
      DIRECTORY_COB, DIRECTORY_COST, DIRECTORY_CSMS, DIRECTORY_DBS,
      DIRECTORY_DOEBIM, DIRECTORY_ELEK, DIRECTORY_EMCS, DIRECTORY_ERISK,
      DIRECTORY_FMOS, DIRECTORY_FOEDC, DIRECTORY_FORDOPKART,
      DIRECTORY_HELPDESK, DIRECTORY_IHRACAT, DIRECTORY_IMS, DIRECTORY_ITHALAT,
      DIRECTORY_MRIC, DIRECTORY_MUHDBA, DIRECTORY_NSMS, DIRECTORY_OSCAR,
      DIRECTORY_OVERTIME, DIRECTORY_PDAED, DIRECTORY_PHONEBOOK, DIRECTORY_PITS,
      DIRECTORY_PORTAL, DIRECTORY_PROGPURCH, DIRECTORY_PROJE, DIRECTORY_PROPS,
      DIRECTORY_PSNR, DIRECTORY_RNCH, DIRECTORY_SAYIM, DIRECTORY_SBI,
      DIRECTORY_SIM, DIRECTORY_TALIMAT, DIRECTORY_TOS, DIRECTORY_WUSRADMIN,
      DIRECTORY_YPSYSTEM, DIRECTORY_YSATIN, EM_TTS_DIR_OBJECT, EXT_TABLE_DIR,
      TRANS.

      Starting in Release 18c, symbolic links are not allowed in directory
      object paths used with BFILE data types, the UTL_FILE package, or
      external tables.

  17. (AUTOFIXUP) Gather dictionary statistics after the upgrade using the
      command:

        EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

      Oracle recommends gathering dictionary statistics after upgrade.

      Dictionary statistics provide essential information to the Oracle
      optimizer to help it find efficient SQL execution plans. After a database
      upgrade, statistics need to be re-gathered as there can now be tables
      that have significantly changed during the upgrade or new tables that do
      not have statistics gathered yet.
      18. Gather statistics on fixed objects after the upgrade and when there is a
      representative workload on the system using the command:

        EXECUTE DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;

      This recommendation is given for all preupgrade runs.

      Fixed object statistics provide essential information to the Oracle
      optimizer to help it find efficient SQL execution plans.  Those
      statistics are specific to the Oracle Database release that generates
      them, and can be stale upon database upgrade.

      For information on managing optimizer statistics, refer to the 11.2.0.4
      Oracle Database Performance Tuning Guide.

  ORACLE GENERATED FIXUP SCRIPT
  =============================
  All of the issues in database FOTO
  which are identified above as AFTER UPGRADE "(AUTOFIXUP)" can be resolved by
  executing the following

    SQL>@/tmp/postupgrade_fixups.sql

12)	Preupgrade fixup çalıştırılır. Manuel müdeahale gerektiren adımlar tek tek fixlenir.

SQL> @preupgrade_fixups.sql
Executing Oracle PRE-Upgrade Fixup Script

Auto-Generated by:       Oracle Preupgrade Script
                         Version: 19.0.0.0.0 Build: 1
Generated on:            2020-04-02 16:56:13

For Source Database:     FOTO
Source Database Version: 11.2.0.4.0
For Upgrade to Version:  19.0.0.0.0

Preup                             Preupgrade
Action                            Issue Is
Number  Preupgrade Check Name     Remedied    Further DBA Action
------  ------------------------  ----------  --------------------------------
    1.  parameter_min_val         NO          Manual fixup recommended.
    2.  invalid_objects_exist     NO          Manual fixup recommended.
    3.  default_resource_limit    NO          Manual fixup recommended.
    4.  network_acl_priv          NO          Manual fixup recommended.
    5.  exclusive_mode_auth       NO          Manual fixup recommended.
    6.  case_insensitive_auth     NO          Manual fixup recommended.
    7.  streams_setup             NO          Manual fixup recommended.
    8.  tde_in_use                NO          Manual fixup recommended.
    9.  mv_refresh                NO          Manual fixup recommended.
   10.  pre_fixed_objects         YES         None.
   11.  parameter_deprecated      NO          Informational only.
                                              Further action is optional.
   12.  exf_rul_exists            NO          Informational only.
                                              Further action is optional.
   13.  rman_recovery_version     NO          Informational only.
                                              Further action is optional.

The fixup scripts have been run and resolved what they can. However,
there are still issues originally identified by the preupgrade that
have not been remedied and are still present in the database.
Depending on the severity of the specific issue, and the nature of
the issue itself, that could mean that your database is not ready
for upgrade.  To resolve the outstanding issues, start by reviewing
the preupgrade_fixups.sql and searching it for the name of
the failed CHECK NAME or Preupgrade Action Number listed above.
There you will find the original corresponding diagnostic message
from the preupgrade which explains in more detail what still needs
to be done.

PL/SQL procedure successfully completed.

a)	java_pool_size aşağıdaki gibi set edilir.
alter system set java_pool_size=117440512;

b)	gereksiz underscore parametreleri reset ile sıfırlanır.
c)	utlrp çalıştırılır.
SQL> @?/rdbms/admin/utlrp.sql

TIMESTAMP
--------------------------------------------------------------------------------
COMP_TIMESTAMP UTLRP_BGN  2020-04-02 17:07:21

DOC>   The following PL/SQL block invokes UTL_RECOMP to recompile invalid
DOC>   objects in the database. Recompilation time is proportional to the
DOC>   number of invalid objects in the database, so this command may take
DOC>   a long time to execute on a database with a large number of invalid
DOC>   objects.
DOC>
DOC>   Use the following queries to track recompilation progress:
DOC>
DOC>   1. Query returning the number of invalid objects remaining. This
DOC>      number should decrease with time.
DOC>         SELECT COUNT(*) FROM obj$ WHERE status IN (4, 5, 6);
DOC>
DOC>   2. Query returning the number of objects compiled so far. This number
DOC>      should increase with time.
DOC>         SELECT COUNT(*) FROM UTL_RECOMP_COMPILED;
DOC>
DOC>   This script automatically chooses serial or parallel recompilation
DOC>   based on the number of CPUs available (parameter cpu_count) multiplied
DOC>   by the number of threads per CPU (parameter parallel_threads_per_cpu).
DOC>   On RAC, this number is added across all RAC nodes.
DOC>
DOC>   UTL_RECOMP uses DBMS_SCHEDULER to create jobs for parallel
DOC>   recompilation. Jobs are created without instance affinity so that they
DOC>   can migrate across RAC nodes. Use the following queries to verify
DOC>   whether UTL_RECOMP jobs are being created and run correctly:
DOC>
DOC>   1. Query showing jobs created by UTL_RECOMP
DOC>         SELECT job_name FROM dba_scheduler_jobs
DOC>            WHERE job_name like 'UTL_RECOMP_SLAVE_%';
DOC>
DOC>   2. Query showing UTL_RECOMP jobs that are running
DOC>         SELECT job_name FROM dba_scheduler_running_jobs
DOC>            WHERE job_name like 'UTL_RECOMP_SLAVE_%';
DOC>#

PL/SQL procedure successfully completed.


TIMESTAMP
--------------------------------------------------------------------------------
COMP_TIMESTAMP UTLRP_END  2020-04-02 17:07:22

DOC> The following query reports the number of objects that have compiled
DOC> with errors.
DOC>
DOC> If the number is higher than expected, please examine the error
DOC> messages reported with each object (using SHOW ERRORS) to see if they
DOC> point to system misconfiguration or resource constraints that must be
DOC> fixed before attempting to recompile these objects.
DOC>#

OBJECTS WITH ERRORS
-------------------
                  0

DOC> The following query reports the number of errors caught during
DOC> recompilation. If this number is non-zero, please query the error
DOC> messages in the table UTL_RECOMP_ERRORS to see if any of these errors
DOC> are due to misconfiguration or resource constraints that must be
DOC> fixed before objects can compile successfully.
DOC>#

ERRORS DURING RECOMPILATION
---------------------------
                          0


Function created.


PL/SQL procedure successfully completed.


Function dropped.


PL/SQL procedure successfully completed.

Hala kalan invalid obje varsa not edilir.

SQL> set lines 1000
SQL> select * from dba_objects where status='INVALID'

OWNER                          OBJECT_NAME                                                                                                                      SUBOBJECT_NAME                  OBJECT_ID DATA_OBJECT_ID OBJECT_TYPE        CREATED   LAST_DDL_ TIMESTAMP           STATUS  T G S  NAMESPACE EDITION_NAME
------------------------------ -------------------------------------------------------------------------------------------------------------------------------- ------------------------------ ---------- -------------- ------------------- --------- --------- ------------------- ------- - - - ---------- ------------------------------
BASE                           V_BI_ORGANIZATION_INTG                                                                                                                                             2724664              MATERIALIZED VIEW   27-JUL-16 27-JUL-16 2016-07-27:12:55:18 INVALID N N N          19

SQL>

d)	post adım olarak false yapılacak. !!!
resource_limit= FALSE
e)	network ACL yedeklenir.
SQL> select * from DBA_NETWORK_ACLS;

HOST
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
LOWER_PORT UPPER_PORT
---------- ----------
ACL
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ACLID
--------------------------------
websmtp1.ford.com.tr
        25         25
/sys/acls/utl_smtp.xml
900006D8A8934C55E0400A88F2C15BDC


HOST
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
LOWER_PORT UPPER_PORT
---------- ----------
ACL
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ACLID
--------------------------------
localhost

/sys/acls/oracle-sysman-ocm-Resolve-Access.xml
E8E4D2AD5ABC420AE043F1C10A883DC9
f)	streams conf kontrol edilir.
SQL> SELECT propagation_name FROM DBA_PROPAGATION;

no rows selected

SQL> select CAPTURE_USER, CAPTURE_NAME, QUEUE_OWNER, QUEUE_NAME from dba_capture where PURPOSE != 'GoldenGate Capture';

no rows selected

SQL> select APPLY_USER, APPLY_NAME, QUEUE_OWNER, QUEUE_NAME from dba_apply where PURPOSE not like 'GoldenGate%';

no rows selected
g)	Custom trigger disable edilir.
SQL> select OWNER,TRIGGER_NAME,STATUS from dba_triggers where OWNER='SYS' and TRIGGER_NAME like 'TRG%';

OWNER                          TRIGGER_NAME                   STATUS
------------------------------ ------------------------------ --------
SYS                            TRG_LOGON_ACTIONS              ENABLED
SYS                            TRG_USER_UNLOCK                ENABLED

SQL> select OWNER,TRIGGER_NAME,STATUS from dba_triggers where OWNER='SYS' and TRIGGER_NAME like '%GRANT%';

OWNER                          TRIGGER_NAME                   STATUS
------------------------------ ------------------------------ --------
SYS                            GRANT_CONTROL                  ENABLED


SQL> alter trigger SYS.TRG_LOGON_ACTIONS disable;

Trigger altered.

SQL> alter trigger SYS.TRG_USER_UNLOCK disable; 

Trigger altered.

SQL> alter trigger SYS.GRANT_CONTROL disable;

Trigger altered.

13)	Database upgrade işlemine başlanır.

Veritabanı kapatılır. Yeni home set edilir ve startup upgrade komutu ile veritabanı açılır.

SQL> SHUTDOWN IMMEDIATE
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> 


oracle@efes:SYSINETTEST1:/u01/oracle/setup> unset LD_LIBRARY_PATH
oracle@efes:SYSINETTEST1:/u01/oracle/setup> unset LD_LIBRARY_PATH_64
oracle@efes:SYSINETTEST1:/u01/oracle/setup> unset ORACLE_BASE
oracle@efes:SYSINETTEST1:/u01/oracle/setup> unset ORACLE_HOME
oracle@efes:SYSINETTEST1:/u01/oracle/setup> unset ORACLE_SID
oracle@efes::/u01/oracle/setup> unset PATH
oracle@efes::/u01/oracle/setup> export ORACLE_HOME=/u01/app/oracle/product/19.0.0.0/dbhome_3
oracle@efes::/u01/oracle/setup> export ORACLE_SID=SYSINETTEST1
oracle@efes:SYSINETTEST1:/u01/oracle/setup> export PATH=$ORACLE_HOME/bin:$PATH
oracle@efes:SYSINETTEST1:/u01/oracle/setup> 
oracle@efes:SYSINETTEST1:/u01/oracle/setup> 
oracle@efes:SYSINETTEST1:/u01/oracle/setup> sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 9 00:28:32 2020
Version 19.7.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to an idle instance.
SQL> startup upgrade;
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 1.0737E+11 bytes
Fixed Size                 23086728 bytes
Variable Size            6.4290E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers              111128576 bytes
Database mounted.
Database opened.

Daha sonra $ORACLE_HOME/bin altından dbupgrade komutu çalıştırılır.
cd $ORACLE_HOME/bin
exa0101vm01@BAYI19|bin]$./dbupgrade  
Argument list for [/u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/catctl.pl]
For Oracle internal use only A = 0
Run in                       c = 0
Do not run in                C = 0
Input Directory              d = 0
Echo OFF                     e = 1
Simulate                     E = 0
Forced cleanup               F = 0
Log Id                       i = 0
Child Process                I = 0
Log Dir                      l = 0
Priority List Name           L = 0
Upgrade Mode active          M = 0
SQL Process Count            n = 0
SQL PDB Process Count        N = 0
Open Mode Normal             o = 0
Start Phase                  p = 0
End Phase                    P = 0
Reverse Order                r = 0
AutoUpgrade Resume           R = 0
Script                       s = 0
Serial Run                   S = 0
RO User Tablespaces          T = 0
Display Phases               y = 0
Debug catcon.pm              z = 0
Debug catctl.pl              Z = 0

catctl.pl VERSION: [19.0.0.0.0]
           STATUS: [Production]
            BUILD: [RDBMS_19.6.0.0.0DBRU_LINUX.X64_191217]


/u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/orahome = [/u02/app/oracle/product/19.0.0/dbhome_1]
/u02/app/oracle/product/19.0.0/dbhome_1/bin/orabasehome = [/u02/app/oracle/product/19.0.0/dbhome_1]
catctlGetOraBaseLogDir = [/u02/app/oracle/product/19.0.0/dbhome_1]

Analyzing file /u02/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/catupgrd.sql

Log file directory = [/tmp/cfgtoollogs/upgrade20200402171849]

catcon::set_log_file_base_path: ALL catcon-related output will be written to [/tmp/cfgtoollogs/upgrade20200402171849/catupgrd_catcon_268687.lst]

catcon::set_log_file_base_path: catcon: See [/tmp/cfgtoollogs/upgrade20200402171849/catupgrd*.log] files for output generated by scripts

catcon::set_log_file_base_path: catcon: See [/tmp/cfgtoollogs/upgrade20200402171849/catupgrd_*.lst] files for spool files, if any


Number of Cpus        = 22
Database Name         = fodb19
DataBase Version      = 11.2.0.4.0
catcon::set_log_file_base_path: ALL catcon-related output will be written to [/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859/catupgrd_catcon_268687.lst]

catcon::set_log_file_base_path: catcon: See [/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859/catupgrd*.log] files for output generated by scripts

catcon::set_log_file_base_path: catcon: See [/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859/catupgrd_*.lst] files for spool files, if any


Log file directory = [/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859]

Parallel SQL Process Count            = 4
Components in [fodb19]
    Installed [CATALOG CATJAVA CATPROC JAVAVM OWM RAC XDB XML]
Not Installed [APEX APS CONTEXT DV EM MGW ODM OLS ORDIM SDO WK XOQ]

------------------------------------------------------
Phases [0-107]         Start Time:[2020_04_02 17:19:13]
------------------------------------------------------
***********   Executing Change Scripts   ***********
Serial   Phase #:0    [fodb19] Files:1    Time: 196s
***************   Catalog Core SQL   ***************
Serial   Phase #:1    [fodb19] Files:5    Time: 32s
Restart  Phase #:2    [fodb19] Files:1    Time: 4s
***********   Catalog Tables and Views   ***********
Parallel Phase #:3    [fodb19] Files:19   Time: 9s
Restart  Phase #:4    [fodb19] Files:1    Time: 4s
*************   Catalog Final Scripts   ************
Serial   Phase #:5    [fodb19] Files:7    Time: 15s
*****************   Catproc Start   ****************
Serial   Phase #:6    [fodb19] Files:1    Time: 11s
*****************   Catproc Types   ****************
Serial   Phase #:7    [fodb19] Files:2    Time: 8s
Restart  Phase #:8    [fodb19] Files:1    Time: 4s
****************   Catproc Tables   ****************
Parallel Phase #:9    [fodb19] Files:67   Time: 14s
Restart  Phase #:10   [fodb19] Files:1    Time: 4s
*************   Catproc Package Specs   ************
Serial   Phase #:11   [fodb19] Files:1    Time: 46s
Restart  Phase #:12   [fodb19] Files:1    Time: 4s
**************   Catproc Procedures   **************
Parallel Phase #:13   [fodb19] Files:94   Time: 5s
Restart  Phase #:14   [fodb19] Files:1    Time: 3s
Parallel Phase #:15   [fodb19] Files:121  Time: 7s
Restart  Phase #:16   [fodb19] Files:1    Time: 4s
Serial   Phase #:17   [fodb19] Files:22   Time: 4s
Restart  Phase #:18   [fodb19] Files:1    Time: 2s
*****************   Catproc Views   ****************
Parallel Phase #:19   [fodb19] Files:32   Time: 10s
Restart  Phase #:20   [fodb19] Files:1    Time: 3s
Serial   Phase #:21   [fodb19] Files:3    Time: 10s
Restart  Phase #:22   [fodb19] Files:1    Time: 2s
Parallel Phase #:23   [fodb19] Files:25   Time: 91s
Restart  Phase #:24   [fodb19] Files:1    Time: 3s
Parallel Phase #:25   [fodb19] Files:12   Time: 59s
Restart  Phase #:26   [fodb19] Files:1    Time: 3s
Serial   Phase #:27   [fodb19] Files:1    Time: 0s
Serial   Phase #:28   [fodb19] Files:3    Time: 4s
Serial   Phase #:29   [fodb19] Files:1    Time: 0s
Restart  Phase #:30   [fodb19] Files:1    Time: 4s
***************   Catproc CDB Views   **************
Serial   Phase #:31   [fodb19] Files:1    Time: 2s
Restart  Phase #:32   [fodb19] Files:1    Time: 3s
Serial   Phase #:34   [fodb19] Files:1    Time: 0s
*****************   Catproc PLBs   *****************
Serial   Phase #:35   [fodb19] Files:294  Time: 106s
Serial   Phase #:36   [fodb19] Files:1    Time: 0s
Restart  Phase #:37   [fodb19] Files:1    Time: 3s
Serial   Phase #:38   [fodb19] Files:6    Time: 6s
Restart  Phase #:39   [fodb19] Files:1    Time: 3s
***************   Catproc DataPump   ***************
Serial   Phase #:40   [fodb19] Files:3    Time: 45s
Restart  Phase #:41   [fodb19] Files:1    Time: 2s
******************   Catproc SQL   *****************
Parallel Phase #:42   [fodb19] Files:13   Time: 61s
Restart  Phase #:43   [fodb19] Files:1    Time: 2s
Parallel Phase #:44   [fodb19] Files:11   Time: 7s
Restart  Phase #:45   [fodb19] Files:1    Time: 3s
Parallel Phase #:46   [fodb19] Files:3    Time: 2s
Restart  Phase #:47   [fodb19] Files:1    Time: 3s
*************   Final Catproc scripts   ************
Serial   Phase #:48   [fodb19] Files:1    Time: 9s
Restart  Phase #:49   [fodb19] Files:1    Time: 2s
**************   Final RDBMS scripts   *************
Serial   Phase #:50   [fodb19] Files:1    Time: 20s
************   Upgrade Component Start   ***********
Serial   Phase #:51   [fodb19] Files:1    Time: 2s
Restart  Phase #:52   [fodb19] Files:1    Time: 2s
**********   Upgrading Java and non-Java   *********
Serial   Phase #:53   [fodb19] Files:2    Time: 264s
*****************   Upgrading XDB   ****************
Restart  Phase #:54   [fodb19] Files:1    Time: 2s
Serial   Phase #:56   [fodb19] Files:3    Time: 15s
Serial   Phase #:57   [fodb19] Files:3    Time: 5s
Parallel Phase #:58   [fodb19] Files:10   Time: 5s
Parallel Phase #:59   [fodb19] Files:25   Time: 7s
Serial   Phase #:60   [fodb19] Files:4    Time: 9s
Serial   Phase #:61   [fodb19] Files:1    Time: 0s
Serial   Phase #:62   [fodb19] Files:32   Time: 5s
Serial   Phase #:63   [fodb19] Files:1    Time: 0s
Parallel Phase #:64   [fodb19] Files:6    Time: 9s
Serial   Phase #:65   [fodb19] Files:2    Time: 17s
Serial   Phase #:66   [fodb19] Files:3    Time: 59s
****************   Upgrading ORDIM   ***************
Restart  Phase #:67   [fodb19] Files:1    Time: 4s
Serial   Phase #:69   [fodb19] Files:1    Time: 4s
Parallel Phase #:70   [fodb19] Files:2    Time: 4s
Restart  Phase #:71   [fodb19] Files:1    Time: 3s
Parallel Phase #:72   [fodb19] Files:2    Time: 4s
Serial   Phase #:73   [fodb19] Files:2    Time: 4s
*****************   Upgrading SDO   ****************
Restart  Phase #:74   [fodb19] Files:1    Time: 2s
Serial   Phase #:76   [fodb19] Files:1    Time: 4s
Serial   Phase #:77   [fodb19] Files:2    Time: 4s
Restart  Phase #:78   [fodb19] Files:1    Time: 4s
Serial   Phase #:79   [fodb19] Files:1    Time: 4s
Restart  Phase #:80   [fodb19] Files:1    Time: 4s
Parallel Phase #:81   [fodb19] Files:3    Time: 4s
Restart  Phase #:82   [fodb19] Files:1    Time: 4s
Serial   Phase #:83   [fodb19] Files:1    Time: 4s
Restart  Phase #:84   [fodb19] Files:1    Time: 3s
Serial   Phase #:85   [fodb19] Files:1    Time: 4s
Restart  Phase #:86   [fodb19] Files:1    Time: 4s
Parallel Phase #:87   [fodb19] Files:4    Time: 4s
Restart  Phase #:88   [fodb19] Files:1    Time: 3s
Serial   Phase #:89   [fodb19] Files:1    Time: 4s
Restart  Phase #:90   [fodb19] Files:1    Time: 3s
Serial   Phase #:91   [fodb19] Files:2    Time: 4s
Restart  Phase #:92   [fodb19] Files:1    Time: 4s
Serial   Phase #:93   [fodb19] Files:1    Time: 3s
Restart  Phase #:94   [fodb19] Files:1    Time: 3s
*******   Upgrading ODM, WK, EXF, RUL, XOQ   *******
Serial   Phase #:95   [fodb19] Files:1    Time: 8s
Restart  Phase #:96   [fodb19] Files:1    Time: 4s
***********   Final Component scripts    ***********
Serial   Phase #:97   [fodb19] Files:1    Time: 4s
*************   Final Upgrade scripts   ************
Serial   Phase #:98   [fodb19] Files:1    Time: 93s
*******************   Migration   ******************
Serial   Phase #:99   [fodb19] Files:1    Time: 69s
***   End PDB Application Upgrade Pre-Shutdown   ***
Serial   Phase #:100  [fodb19] Files:1    Time: 2s
Serial   Phase #:101  [fodb19] Files:1    Time: 0s
Serial   Phase #:102  [fodb19] Files:1    Time: 60s
*****************   Post Upgrade   *****************
Serial   Phase #:103  [fodb19] Files:1    Time: 37s
****************   Summary report   ****************
Serial   Phase #:104  [fodb19] Files:1    Time: 3s
***   End PDB Application Upgrade Post-Shutdown   **
Serial   Phase #:105  [fodb19] Files:1    Time: 2s
Serial   Phase #:106  [fodb19] Files:1    Time: 0s
Serial   Phase #:107  [fodb19] Files:1     Time: 29s

------------------------------------------------------
Phases [0-107]         End Time:[2020_04_02 17:46:45]
------------------------------------------------------

Grand Total Time: 1653s 

 LOG FILES: (/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859/catupgrd*.log)

Upgrade Summary Report Located in:
/u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/fodb19/upgrade20200402171859/upg_summary.log

Grand Total Upgrade Time:    [0d:0h:27m:33s]




SQL> STARTUP
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 1.0737E+11 bytes
Fixed Size                 23086728 bytes
Variable Size            6.4290E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers              111128576 bytes
Database mounted.
Database opened.

14)	utlusts.sql çalıştırılır.
Note: In 19c Earlier version utluNNNs.sql is replaced by utlusts.sql

SQL> spool /tmp/utlusts_fodb19.log
SQL> @?/rdbms/admin/utlusts.sql TEXT


Oracle Database Release 19 Post-Upgrade Status Tool    04-02-2020 17:48:5
Database Name: FOTO

Component                               Current         Full     Elapsed Time
Name                                    Status          Version  HH:MM:SS

Oracle Server                          UPGRADED      19.6.0.0.0  00:14:01
JServer JAVA Virtual Machine           UPGRADED      19.6.0.0.0  00:03:03
Oracle XDK                             UPGRADED      19.6.0.0.0  00:00:25
Oracle Database Java Packages          UPGRADED      19.6.0.0.0  00:00:09
Oracle Workspace Manager               UPGRADED      19.6.0.0.0  00:00:42
Oracle Real Application Clusters       UPGRADED      19.6.0.0.0  00:00:00
Oracle XML Database                    UPGRADED      19.6.0.0.0  00:02:07
Datapatch                                                        00:01:23
Final Actions                                                    00:02:42
Post Upgrade                                                     00:00:34

Total Upgrade Time: 00:25:49

Database time zone version is 14. It is older than current release time
zone version 32. Time zone upgrade is needed using the DBMS_DST package

15)	utlrp.sql çalıştırılır.

DBA_REGISTRY de INVALID componentler VALID olana kadar çalıştırılır.
SQL> @?/rdbms/admin/utlrp.sql

TIMESTAMP
--------------------------------------------------------------------------------
COMP_TIMESTAMP UTLRP_BGN              2020-04-02 17:49:13
DOC>   The following PL/SQL block invokes UTL_RECOMP to recompile invalid
DOC>   objects in the database. Recompilation time is proportional to the
DOC>   number of invalid objects in the database, so this command may take
DOC>   a long time to execute on a database with a large number of invalid
DOC>   objects.
DOC>
DOC>   Use the following queries to track recompilation progress:
DOC>
DOC>   1. Query returning the number of invalid objects remaining. This
DOC>      number should decrease with time.
DOC>         SELECT COUNT(*) FROM obj$ WHERE status IN (4, 5, 6);
DOC>
DOC>   2. Query returning the number of objects compiled so far. This number
DOC>      should increase with time.
DOC>         SELECT COUNT(*) FROM UTL_RECOMP_COMPILED;
DOC>
DOC>   This script automatically chooses serial or parallel recompilation
DOC>   based on the number of CPUs available (parameter cpu_count) multiplied
DOC>   by the number of threads per CPU (parameter parallel_threads_per_cpu).
DOC>   On RAC, this number is added across all RAC nodes.
DOC>
DOC>   UTL_RECOMP uses DBMS_SCHEDULER to create jobs for parallel
DOC>   recompilation. Jobs are created without instance affinity so that they
DOC>   can migrate across RAC nodes. Use the following queries to verify
DOC>   whether UTL_RECOMP jobs are being created and run correctly:
DOC>
DOC>   1. Query showing jobs created by UTL_RECOMP
DOC>         SELECT job_name FROM dba_scheduler_jobs
DOC>            WHERE job_name like 'UTL_RECOMP_SLAVE_%';
DOC>
DOC>   2. Query showing UTL_RECOMP jobs that are running
DOC>         SELECT job_name FROM dba_scheduler_running_jobs
DOC>            WHERE job_name like 'UTL_RECOMP_SLAVE_%';
DOC>#

TIMESTAMP
--------------------------------------------------------------------------------
COMP_TIMESTAMP UTLRP_END              2020-04-02 19:11:45
DOC> The following query reports the number of invalid objects.
DOC>
DOC> If the number is higher than expected, please examine the error
DOC> messages reported with each object (using SHOW ERRORS) to see if they
DOC> point to system misconfiguration or resource constraints that must be
DOC> fixed before attempting to recompile these objects.
DOC>#

OBJECTS WITH ERRORS
-------------------
                168
DOC> The following query reports the number of exceptions caught during
DOC> recompilation. If this number is non-zero, please query the error
DOC> messages in the table UTL_RECOMP_ERRORS to see if any of these errors
DOC> are due to misconfiguration or resource constraints that must be
DOC> fixed before objects can compile successfully.
DOC> Note: Typical compilation errors (due to coding errors) are not
DOC>       logged into this table: they go into DBA_ERRORS instead.
DOC>#

ERRORS DURING RECOMPILATION
---------------------------
                        102



SQL> SQL> SQL> SQL> SQL> column COMP_NAME format a40
SQL> column VERSION format a10
SQL> 
SQL> select COMP_NAME,VERSION,STATUS from dba_registry;

COMP_NAME                                VERSION    STATUS
---------------------------------------- ---------- -----------
Oracle Database Catalog Views            19.0.0.0.0 VALID
Oracle Database Packages and Types       19.0.0.0.0 VALID
JServer JAVA Virtual Machine             19.0.0.0.0 VALID
Oracle XDK                               19.0.0.0.0 VALID
Oracle Database Java Packages            19.0.0.0.0 VALID
Oracle Real Application Clusters         19.0.0.0.0 VALID
Oracle Workspace Manager                 19.0.0.0.0 VALID
Oracle XML Database                      19.0.0.0.0 VALID

16)	postupgrade fixup çalıştırılır.
SQL> @postupgrade_fixups_fodb.sql

Session altered.


PL/SQL procedure successfully completed.


PL/SQL procedure successfully completed.


PL/SQL procedure successfully completed.


Package created.

No errors.

Package body created.


PL/SQL procedure successfully completed.

No errors.

Package created.

No errors.

Package body created.

No errors.
Executing Oracle POST-Upgrade Fixup Script

Auto-Generated by:       Oracle Preupgrade Script
                         Version: 19.0.0.0.0 Build: 1
Generated on:            2020-04-02 16:56:16

For Source Database:     FOTO
Source Database Version: 11.2.0.4.0
For Upgrade to Version:  19.0.0.0.0

Preup                             Preupgrade
Action                            Issue Is
Number  Preupgrade Check Name     Remedied    Further DBA Action
------  ------------------------  ----------  --------------------------------
   14.  depend_usr_tables         YES         None.
   15.  old_time_zones_exist      NO          Manual fixup recommended.
   16.  dir_symlinks              YES         None.
   17.  post_dictionary           YES         None.
   18.  post_fixed_objects        NO          Informational only.
                                              Further action is optional.

The fixup scripts have been run and resolved what they can. However,
there are still issues originally identified by the preupgrade that
have not been remedied and are still present in the database.
Depending on the severity of the specific issue, and the nature of
the issue itself, that could mean that your database upgrade is not
fully complete.  To resolve the outstanding issues, start by reviewing
the postupgrade_fixups.sql and searching it for the name of
the failed CHECK NAME or Preupgrade Action Number listed above.
There you will find the original corresponding diagnostic message
from the preupgrade which explains in more detail what still needs
to be done.

PL/SQL procedure successfully completed.

17)	Time Zone upgarde yapılır.
SQL> @$ORACLE_HOME/rdbms/admin/utltz_countstats.sql

Session altered.

 .
 Amount of TSTZ data using num_rows stats info in DBA_TABLES.
 .
 For SYS tables first ...
 Note: empty tables are not listed.
 Stat date  - Owner.TableName.ColumnName - num_rows
25/11/2019 - SYS.AQ$_ALERT_QT_S.CREATION_TIME - 22
25/11/2019 - SYS.AQ$_ALERT_QT_S.DELETION_TIME - 22
25/11/2019 - SYS.AQ$_ALERT_QT_S.MODIFICATION_TIME - 22
20/09/2017 - SYS.AQ$_AQ$_MEM_MC_S.CREATION_TIME - 4
20/09/2017 - SYS.AQ$_AQ$_MEM_MC_S.DELETION_TIME - 4
20/09/2017 - SYS.AQ$_AQ$_MEM_MC_S.MODIFICATION_TIME - 4
20/09/2017 - SYS.AQ$_AQ_PROP_TABLE_S.CREATION_TIME - 3
20/09/2017 - SYS.AQ$_AQ_PROP_TABLE_S.DELETION_TIME - 3
20/09/2017 - SYS.AQ$_AQ_PROP_TABLE_S.MODIFICATION_TIME - 3
02/04/2020 - SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.CREATION_TIME - 1
02/04/2020 - SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.DELETION_TIME - 1
02/04/2020 - SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.MODIFICATION_TIME - 1
02/04/2020 - SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.CREATION_TIME - 1
02/04/2020 - SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.DELETION_TIME - 1
02/04/2020 - SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.MODIFICATION_TIME - 1
02/04/2020 - SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.CREATION_TIME - 4
02/04/2020 - SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.DELETION_TIME - 4
02/04/2020 - SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.MODIFICATION_TIME - 4
20/09/2017 - SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.CREATION_TIME - 3
20/09/2017 - SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.DELETION_TIME - 3
20/09/2017 - SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.MODIFICATION_TIME - 3
20/09/2017 - SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.CREATION_TIME - 3
20/09/2017 - SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.DELETION_TIME - 3
20/09/2017 - SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.MODIFICATION_TIME - 3
02/04/2020 - SYS.AQ$_SUBSCRIBER_TABLE.CREATION_TIME - 1
02/04/2020 - SYS.AQ$_SUBSCRIBER_TABLE.DELETION_TIME - 1
02/04/2020 - SYS.AQ$_SUBSCRIBER_TABLE.MODIFICATION_TIME - 1
02/04/2020 - SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.CREATION_TIME - 4
02/04/2020 - SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.DELETION_TIME - 4
02/04/2020 - SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.MODIFICATION_TIME - 4
02/04/2020 - SYS.ATSK$_SCHEDULE_CONTROL.MRCT_TASK_TIME_TZ - 1
02/04/2020 - SYS.KET$_AUTOTASK_STATUS.ABA_START_TIME - 1
02/04/2020 - SYS.KET$_AUTOTASK_STATUS.ABA_STATE_TIME - 1
02/04/2020 - SYS.KET$_AUTOTASK_STATUS.MW_RECORD_TIME - 1
02/04/2020 - SYS.KET$_AUTOTASK_STATUS.MW_START_TIME - 1
02/04/2020 - SYS.KET$_AUTOTASK_STATUS.RECONCILE_TIME - 1
02/04/2020 - SYS.KET$_CLIENT_CONFIG.FIELD_2 - 7
02/04/2020 - SYS.KET$_CLIENT_CONFIG.LAST_CHANGE - 7
02/04/2020 - SYS.KET$_CLIENT_TASKS.CURR_WIN_START - 1
02/04/2020 - SYS.KET$_CLIENT_TASKS.LG_DATE - 1
02/04/2020 - SYS.KET$_CLIENT_TASKS.LT_DATE - 1
02/04/2020 - SYS.OPTSTAT_HIST_CONTROL$.SPARE6 - 45
02/04/2020 - SYS.OPTSTAT_HIST_CONTROL$.SVAL2 - 45
02/04/2020 - SYS.OPTSTAT_SNAPSHOT$.TIMESTAMP - 7023
02/04/2020 - SYS.OPTSTAT_USER_PREFS$.CHGTIME - 72
24/10/2016 - SYS.RADM_FPTM$.TSWTZ_COL - 1
02/04/2020 - SYS.REG$.NTFN_GROUPING_START_TIME - 16
02/04/2020 - SYS.REG$.REG_TIME - 16
29/03/2020 - SYS.SCHEDULER$_EVENT_LOG.LOG_DATE - 49412
02/04/2020 - SYS.SCHEDULER$_GLOBAL_ATTRIBUTE.ATTR_TSTAMP - 11
02/04/2020 - SYS.SCHEDULER$_JOB.END_DATE - 110
02/04/2020 - SYS.SCHEDULER$_JOB.LAST_ENABLED_TIME - 110
02/04/2020 - SYS.SCHEDULER$_JOB.LAST_END_DATE - 110
02/04/2020 - SYS.SCHEDULER$_JOB.LAST_START_DATE - 110
02/04/2020 - SYS.SCHEDULER$_JOB.NEXT_RUN_DATE - 110
02/04/2020 - SYS.SCHEDULER$_JOB.START_DATE - 110
02/04/2020 - SYS.SCHEDULER$_JOB_RUN_DETAILS.LOG_DATE - 8569
02/04/2020 - SYS.SCHEDULER$_JOB_RUN_DETAILS.REQ_START_DATE - 8569
02/04/2020 - SYS.SCHEDULER$_JOB_RUN_DETAILS.START_DATE - 8569
02/04/2020 - SYS.SCHEDULER$_SCHEDULE.END_DATE - 4
02/04/2020 - SYS.SCHEDULER$_SCHEDULE.REFERENCE_DATE - 4
02/04/2020 - SYS.SCHEDULER$_WINDOW.ACTUAL_START_DATE - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW.END_DATE - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW.LAST_START_DATE - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW.MANUAL_OPEN_TIME - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW.NEXT_START_DATE - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW.START_DATE - 9
02/04/2020 - SYS.SCHEDULER$_WINDOW_DETAILS.LOG_DATE - 28
02/04/2020 - SYS.SCHEDULER$_WINDOW_DETAILS.REQ_START_DATE - 28
02/04/2020 - SYS.SCHEDULER$_WINDOW_DETAILS.START_DATE - 28
31/03/2020 - SYS.STATS_TARGET$.END_TIME - 30947
31/03/2020 - SYS.STATS_TARGET$.START_TIME - 30947
02/04/2020 - SYS.TAB_STATS$.SPARE6 - 826
02/04/2020 - SYS.WRI$_ALERT_HISTORY.CREATION_TIME - 16
02/04/2020 - SYS.WRI$_ALERT_HISTORY.TIME_SUGGESTED - 16
02/04/2020 - SYS.WRI$_ALERT_OUTSTANDING.CREATION_TIME - 2
02/04/2020 - SYS.WRI$_ALERT_OUTSTANDING.TIME_SUGGESTED - 2
02/04/2020 - SYS.WRI$_OPTSTAT_HISTGRM_HISTORY.SAVTIME - 7020375
02/04/2020 - SYS.WRI$_OPTSTAT_HISTGRM_HISTORY.SPARE6 - 7020375
02/04/2020 - SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY.SAVTIME - 550230
02/04/2020 - SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY.SPARE6 - 550230
02/04/2020 - SYS.WRI$_OPTSTAT_IND_HISTORY.SAVTIME - 32233
02/04/2020 - SYS.WRI$_OPTSTAT_IND_HISTORY.SPARE6 - 32233
02/04/2020 - SYS.WRI$_OPTSTAT_OPR.END_TIME - 375
02/04/2020 - SYS.WRI$_OPTSTAT_OPR.SPARE6 - 375
02/04/2020 - SYS.WRI$_OPTSTAT_OPR.START_TIME - 375
02/04/2020 - SYS.WRI$_OPTSTAT_OPR_TASKS.END_TIME - 3076
02/04/2020 - SYS.WRI$_OPTSTAT_OPR_TASKS.SPARE6 - 3076
02/04/2020 - SYS.WRI$_OPTSTAT_OPR_TASKS.START_TIME - 3076
02/04/2020 - SYS.WRI$_OPTSTAT_TAB_HISTORY.SAVTIME - 30176
02/04/2020 - SYS.WRI$_OPTSTAT_TAB_HISTORY.SPARE6 - 30176
02/04/2020 - SYS.WRM$_DATABASE_INSTANCE.STARTUP_TIME_TZ - 11
02/04/2020 - SYS.WRM$_PDB_INSTANCE.OPEN_TIME_TZ - 1
02/04/2020 - SYS.WRM$_PDB_INSTANCE.STARTUP_TIME_TZ - 1
02/04/2020 - SYS.WRM$_PDB_IN_SNAP.OPEN_TIME_TZ - 2
02/04/2020 - SYS.WRM$_SNAPSHOT.BEGIN_INTERVAL_TIME_TZ - 382
02/04/2020 - SYS.WRM$_SNAPSHOT.END_INTERVAL_TIME_TZ - 382
02/04/2020 - SYS.XS$PRIN.END_DATE - 15
02/04/2020 - SYS.XS$PRIN.START_DATE - 15
 Total numrows of SYS TSTZ columns is : 15423261
 There are in total 165 SYS TSTZ columns.
 .
 For non-SYS tables ...
 Note: empty tables are not listed.
 Stat date  - Owner.Tablename.Columnname - num_rows
23/03/2020 - DBSNMP.MGMT_DB_FEATURE_LOG.LAST_UPDATE_DATE - 3
02/04/2020 - GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.CREATION_TIME - 1
02/04/2020 - GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.DELETION_TIME - 1
02/04/2020 - GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.MODIFICATION_TIME - 1
02/04/2020 - WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.CREATION_TIME - 1
02/04/2020 - WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.DELETION_TIME - 1
02/04/2020 - WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.MODIFICATION_TIME - 1
02/04/2020 - WMSYS.WM$WORKSPACES_TABLE$.CREATETIME - 1
02/04/2020 - WMSYS.WM$WORKSPACES_TABLE$.LAST_CHANGE - 1
 Total numrows of non-SYS TSTZ columns is : 11
 There are in total 17 non-SYS TSTZ columns.
 Total Minutes elapsed : 0

Session altered.


SQL> @$ORACLE_HOME/rdbms/admin/utltz_countstar.sql

Session altered.

 .
 Estimating amount of TSTZ data using COUNT(*).
 This might take some time ...
 .
 For SYS tables first ...
 Note: empty tables are not listed.
 Owner.TableName.ColumnName - COUNT(*) of that column
SYS.ALERT_QT.SYS_NC00029$ - 25
SYS.AQ$_ALERT_QT_S.CREATION_TIME - 22
SYS.AQ$_ALERT_QT_S.DELETION_TIME - 22
SYS.AQ$_ALERT_QT_S.MODIFICATION_TIME - 22
SYS.AQ$_AQ$_MEM_MC_S.CREATION_TIME - 4
SYS.AQ$_AQ$_MEM_MC_S.DELETION_TIME - 4
SYS.AQ$_AQ$_MEM_MC_S.MODIFICATION_TIME - 4
SYS.AQ$_AQ_PROP_TABLE_S.CREATION_TIME - 3
SYS.AQ$_AQ_PROP_TABLE_S.DELETION_TIME - 3
SYS.AQ$_AQ_PROP_TABLE_S.MODIFICATION_TIME - 3
SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.CREATION_TIME - 1
SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.DELETION_TIME - 1
SYS.AQ$_ORA$PREPLUGIN_BACKUP_QTB_S.MODIFICATION_TIME - 1
SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.CREATION_TIME - 1
SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.DELETION_TIME - 1
SYS.AQ$_PDB_MON_EVENT_QTABLE$_S.MODIFICATION_TIME - 1
SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.CREATION_TIME - 4
SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.DELETION_TIME - 4
SYS.AQ$_SCHEDULER$_EVENT_QTAB_S.MODIFICATION_TIME - 4
SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.CREATION_TIME - 3
SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.DELETION_TIME - 3
SYS.AQ$_SCHEDULER$_REMDB_JOBQTAB_S.MODIFICATION_TIME - 3
SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.CREATION_TIME - 3
SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.DELETION_TIME - 3
SYS.AQ$_SCHEDULER_FILEWATCHER_QT_S.MODIFICATION_TIME - 3
SYS.AQ$_SUBSCRIBER_TABLE.CREATION_TIME - 1
SYS.AQ$_SUBSCRIBER_TABLE.DELETION_TIME - 1
SYS.AQ$_SUBSCRIBER_TABLE.MODIFICATION_TIME - 1
SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.CREATION_TIME - 4
SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.DELETION_TIME - 4
SYS.AQ$_SYS$SERVICE_METRICS_TAB_S.MODIFICATION_TIME - 4
SYS.ATSK$_SCHEDULE_CONTROL.MRCT_TASK_TIME_TZ - 1
SYS.KET$_AUTOTASK_STATUS.ABA_START_TIME - 1
SYS.KET$_AUTOTASK_STATUS.ABA_STATE_TIME - 1
SYS.KET$_AUTOTASK_STATUS.MW_RECORD_TIME - 1
SYS.KET$_AUTOTASK_STATUS.MW_START_TIME - 1
SYS.KET$_AUTOTASK_STATUS.RECONCILE_TIME - 1
SYS.KET$_CLIENT_CONFIG.FIELD_2 - 7
SYS.KET$_CLIENT_CONFIG.LAST_CHANGE - 7
SYS.KET$_CLIENT_TASKS.CURR_WIN_START - 1
SYS.KET$_CLIENT_TASKS.LG_DATE - 1
SYS.KET$_CLIENT_TASKS.LT_DATE - 1
SYS.OPTSTAT_HIST_CONTROL$.SPARE6 - 45
SYS.OPTSTAT_HIST_CONTROL$.SVAL2 - 45
SYS.OPTSTAT_SNAPSHOT$.TIMESTAMP - 7446
SYS.OPTSTAT_USER_PREFS$.CHGTIME - 72
SYS.RADM_FPTM$.TSWTZ_COL - 1
SYS.REG$.NTFN_GROUPING_START_TIME - 16
SYS.REG$.REG_TIME - 16
SYS.SCHEDULER$_EVENT_LOG.LOG_DATE - 49486
SYS.SCHEDULER$_GLOBAL_ATTRIBUTE.ATTR_TSTAMP - 11
SYS.SCHEDULER$_JOB.END_DATE - 110
SYS.SCHEDULER$_JOB.LAST_ENABLED_TIME - 110
SYS.SCHEDULER$_JOB.LAST_END_DATE - 110
SYS.SCHEDULER$_JOB.LAST_START_DATE - 110
SYS.SCHEDULER$_JOB.NEXT_RUN_DATE - 110
SYS.SCHEDULER$_JOB.START_DATE - 110
SYS.SCHEDULER$_JOB_RUN_DETAILS.LOG_DATE - 8568
SYS.SCHEDULER$_JOB_RUN_DETAILS.REQ_START_DATE - 8568
SYS.SCHEDULER$_JOB_RUN_DETAILS.START_DATE - 8568
SYS.SCHEDULER$_SCHEDULE.END_DATE - 4
SYS.SCHEDULER$_SCHEDULE.REFERENCE_DATE - 4
SYS.SCHEDULER$_WINDOW.ACTUAL_START_DATE - 9
SYS.SCHEDULER$_WINDOW.END_DATE - 9
SYS.SCHEDULER$_WINDOW.LAST_START_DATE - 9
SYS.SCHEDULER$_WINDOW.MANUAL_OPEN_TIME - 9
SYS.SCHEDULER$_WINDOW.NEXT_START_DATE - 9
SYS.SCHEDULER$_WINDOW.START_DATE - 9
SYS.SCHEDULER$_WINDOW_DETAILS.LOG_DATE - 28
SYS.SCHEDULER$_WINDOW_DETAILS.REQ_START_DATE - 28
SYS.SCHEDULER$_WINDOW_DETAILS.START_DATE - 28
SYS.STATS_TARGET$.END_TIME - 30854
SYS.STATS_TARGET$.START_TIME - 30854
SYS.TAB_STATS$.SPARE6 - 826
SYS.WRI$_ALERT_HISTORY.CREATION_TIME - 16
SYS.WRI$_ALERT_HISTORY.TIME_SUGGESTED - 16
SYS.WRI$_ALERT_OUTSTANDING.CREATION_TIME - 2
SYS.WRI$_ALERT_OUTSTANDING.TIME_SUGGESTED - 2
SYS.WRI$_OPTSTAT_HISTGRM_HISTORY.SAVTIME - 7083017
SYS.WRI$_OPTSTAT_HISTGRM_HISTORY.SPARE6 - 7083017
SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY.SAVTIME - 581641
SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY.SPARE6 - 581641
SYS.WRI$_OPTSTAT_IND_HISTORY.SAVTIME - 33520
SYS.WRI$_OPTSTAT_IND_HISTORY.SPARE6 - 33520
SYS.WRI$_OPTSTAT_OPR.END_TIME - 375
SYS.WRI$_OPTSTAT_OPR.SPARE6 - 375
SYS.WRI$_OPTSTAT_OPR.START_TIME - 375
SYS.WRI$_OPTSTAT_OPR_TASKS.END_TIME - 3085
SYS.WRI$_OPTSTAT_OPR_TASKS.SPARE6 - 3085
SYS.WRI$_OPTSTAT_OPR_TASKS.START_TIME - 3085
SYS.WRI$_OPTSTAT_TAB_HISTORY.SAVTIME - 32479
SYS.WRI$_OPTSTAT_TAB_HISTORY.SPARE6 - 32479
SYS.WRM$_DATABASE_INSTANCE.STARTUP_TIME_TZ - 11
SYS.WRM$_PDB_INSTANCE.OPEN_TIME_TZ - 1
SYS.WRM$_PDB_INSTANCE.STARTUP_TIME_TZ - 1
SYS.WRM$_PDB_IN_SNAP.OPEN_TIME_TZ - 2
SYS.WRM$_SNAPSHOT.BEGIN_INTERVAL_TIME_TZ - 385
SYS.WRM$_SNAPSHOT.END_INTERVAL_TIME_TZ - 385
SYS.XS$PRIN.END_DATE - 15
SYS.XS$PRIN.START_DATE - 15
 Total count * of SYS TSTZ columns is : 15618913
 There are in total 165 SYS TSTZ columns.
 .
 For non-SYS tables ...
 Note: empty tables are not listed.
 Owner.TableName.ColumnName - COUNT(*) of that column
DBSNMP.MGMT_DB_FEATURE_LOG.LAST_UPDATE_DATE - 3
GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.CREATION_TIME - 1
GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.DELETION_TIME - 1
GSMADMIN_INTERNAL.AQ$_CHANGE_LOG_QUEUE_TABLE_S.MODIFICATION_TIME - 1
WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.CREATION_TIME - 1
WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.DELETION_TIME - 1
WMSYS.AQ$_WM$EVENT_QUEUE_TABLE_S.MODIFICATION_TIME - 1
WMSYS.WM$WORKSPACES_TABLE$.CREATETIME - 1
WMSYS.WM$WORKSPACES_TABLE$.LAST_CHANGE - 1
 Total count * of non-SYS TSTZ columns is :  11
 There are in total 17 non-SYS TSTZ columns.
 Total Minutes elapsed : 0

Session altered.


SQL> @$ORACLE_HOME/rdbms/admin/utltz_upg_check.sql

Session altered.

INFO: Starting with RDBMS DST update preparation.
INFO: NO actual RDBMS DST update will be done by this script.
INFO: If an ERROR occurs the script will EXIT sqlplus.
INFO: Doing checks for known issues ...
INFO: Database version is 19.0.0.0 .
INFO: Database RDBMS DST version is DSTv14 .
INFO: No known issues detected.
INFO: Now detecting new RDBMS DST version.
A prepare window has been successfully started.
INFO: Newest RDBMS DST version detected is DSTv32 .
INFO: Next step is checking all TSTZ data.
INFO: It might take a while before any further output is seen ...
A prepare window has been successfully ended.
INFO: A newer RDBMS DST version than the one currently used is found.
INFO: Note that NO DST update was yet done.
INFO: Now run utltz_upg_apply.sql to do the actual RDBMS DST update.
INFO: Note that the utltz_upg_apply.sql script will
INFO: restart the database 2 times WITHOUT any confirmation or prompt.

Session altered.



SQL> @?/rdbms/admin/utltz_upg_apply.sql

Session altered.

INFO: If an ERROR occurs, the script will EXIT SQL*Plus.
INFO: The database RDBMS DST version will be updated to DSTv32 .
WARNING: This script will restart the database 2 times
WARNING: WITHOUT asking ANY confirmation.
WARNING: Hit control-c NOW if this is not intended.
INFO: Restarting the database in UPGRADE mode to start the DST upgrade.
Database closed.
Database dismounted.
ORACLE instance shut down.
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 8287943936 bytes
Fixed Size                  8916224 bytes
Variable Size            3087007744 bytes
Database Buffers         5133828096 bytes
Redo Buffers               58191872 bytes
Database mounted.
Database opened.
INFO: Starting the RDBMS DST upgrade.
INFO: Upgrading all SYS owned TSTZ data.
INFO: It might take time before any further output is seen ...
An upgrade window has been successfully started.
INFO: Restarting the database in NORMAL mode to upgrade non-SYS TSTZ data.
Database closed.
Database dismounted.
ORACLE instance shut down.
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 8287943936 bytes
Fixed Size                  8916224 bytes
Variable Size            3087007744 bytes
Database Buffers         5133828096 bytes
Redo Buffers               58191872 bytes
Database mounted.
Database opened.
INFO: Upgrading all non-SYS TSTZ data.
INFO: It might take time before any further output is seen ...
INFO: Do NOT start any application yet that uses TSTZ data!
INFO: Next is a list of all upgraded tables:
Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_L"
Number of failures: 0
Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_S"
Number of failures: 0
INFO: Total failures during update of TSTZ data: 0 .
An upgrade window has been successfully ended.
INFO: Your new Server RDBMS DST version is DSTv32 .
INFO: The RDBMS DST update is successfully finished.
INFO: Make sure to exit this SQL*Plus session.
INFO: Do not use it for timezone related selects.

Session altered.



SQL> select * from v$timezone_file;

FILENAME                VERSION     CON_ID
-------------------- ---------- ----------
timezlrg_32.dat              32          0

1 row selected.


Session altered.

18)	$ORACLE_HOME ve /etc/oratab düzenlenir.

oracle@efes:SYSINETTEST1:/u01/oracle> srvctl config database -d SYSINETTEST
PRCD-1229 : An attempt to access configuration of database SYSINETTEST was rejected because its version 11.2.0.4.0 differs from the program version 19.0.0.0.0. Instead run the program from /u01/app/oracle/product/11.2.0.4/dbhome_3.

11.2.0.4 üzerinden 
oracle@efes:INTFRAUDTEST1:/u01/oracle> srvctl remove database -d SYSINETTEST
Remove the database SYSINETTEST? (y/[n]) y
19.7 üzerinden
oracle@efes:SYSINETTEST1:/u01/oracle> srvctl add database -d SYSINETTEST -oraclehome /u01/app/oracle/product/19.0.0.0/dbhome_3 -dbtype RAC -spfile +DG_CORE_DATA/sysinettest_rac/spfilesysinettest.ora 
oracle@efes:SYSINETTEST1:/u01/oracle> srvctl add instance -d SYSINETTEST -i SYSINETTEST1 -node efes
oracle@efes:SYSINETTEST1:/u01/oracle> srvctl add instance -d SYSINETTEST -i SYSINETTEST2 -node ares
oracle@efes:SYSINETTEST1:/u01/oracle> srvctl add service -d SYSINETTEST -service CORE_SYSINETTEST -preferred SYSINETTEST2
19)	Backup adımları
Her iki node üzerinde de /u01/oracle/netbackup/scripts altında bulunan ilgili db nin full ve archive backupını alan scriptlerde aşağıdaki yerler değiştirilmelidir.
ORACLE_HOME=/u01/app/oracle/product/19.0.0.0/dbhome_3
$RMAN target $TARGET_CONNECT_STR catalog RMAN19700/sNlwk#23NDsad@CATMAN msglog $RMAN_LOG_FILE append << EOF

Son olarak library için aşağıdaki linkleme yapılmalıdır.
ln -sf /usr/openv/netbackup/bin/libobk.so64.1 /u01/app/oracle/product/19.0.0.0/dbhome_3/lib/libobk.so








19C Downgrade

Patches to apply before upgrading Oracle GI and DB to 19c or downgrading to previous release (Doc ID 2539751.1) Dokümanı takip edilir.
Downgrade işlemi için 2089899 ve 20348910 nolu patchler gereklidir. Patches to apply before upgrading Oracle GI and DB to 19c or downgrading to previous release (Doc ID 2539751.1)
 
   
[oracle@exa0101vm01 20898997]$ opatch apply -local
Oracle Interim Patch Installer version 11.2.0.3.21
Copyright (c) 2020, Oracle Corporation.  All rights reserved.


Oracle Home       : /u02/app/oracle/product/11.2.0/dbhome_1
Central Inventory : /u01/app/oraInventory
   from           : /u02/app/oracle/product/11.2.0/dbhome_1/oraInst.loc
OPatch version    : 11.2.0.3.21
OUI version       : 11.2.0.4.0
Log file location : /u02/app/oracle/product/11.2.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-08_10-34-40AM_1.log

Verifying environment and performing prerequisite checks...
OPatch continues with these patches:   20898997  

Do you want to proceed? [y|n]
y
User Responded with: Y
All checks passed.
Provide your email address to be informed of security issues, install and
initiate Oracle Configuration Manager. Easier for you if you use your My
Oracle Support Email address/User Name.
Visit http://www.oracle.com/support/policies.html for details.
Email address/User Name: 

You have not provided an email address for notification of security issues.
Do you wish to remain uninformed of security issues ([Y]es, [N]o) [N]:  y



Please shutdown Oracle instances running out of this ORACLE_HOME on the local system.
(Oracle Home = '/u02/app/oracle/product/11.2.0/dbhome_1')


Is the local system ready for patching? [y|n]
y
User Responded with: Y
Backing up files...
Applying interim patch '20898997' to OH '/u02/app/oracle/product/11.2.0/dbhome_1'

Patching component oracle.rdbms.rsf, 11.2.0.4.0...

Patching component oracle.rdbms, 11.2.0.4.0...
Patch 20898997 successfully applied.
Log file location: /u02/app/oracle/product/11.2.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-08_10-34-40AM_1.log

OPatch succeeded.



[oracle@exa0101vm01 20348910]$ opatch apply -local
Oracle Interim Patch Installer version 11.2.0.3.21
Copyright (c) 2020, Oracle Corporation.  All rights reserved.


Oracle Home       : /u02/app/oracle/product/11.2.0/dbhome_1
Central Inventory : /u01/app/oraInventory
   from           : /u02/app/oracle/product/11.2.0/dbhome_1/oraInst.loc
OPatch version    : 11.2.0.3.21
OUI version       : 11.2.0.4.0
Log file location : /u02/app/oracle/product/11.2.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-08_10-35-48AM_1.log

Verifying environment and performing prerequisite checks...
OPatch continues with these patches:   20348910  

Do you want to proceed? [y|n]
y
User Responded with: Y
All checks passed.
Provide your email address to be informed of security issues, install and
initiate Oracle Configuration Manager. Easier for you if you use your My
Oracle Support Email address/User Name.
Visit http://www.oracle.com/support/policies.html for details.
Email address/User Name: 

You have not provided an email address for notification of security issues.
Do you wish to remain uninformed of security issues ([Y]es, [N]o) [N]:  y


Backing up files...
Applying interim patch '20348910' to OH '/u02/app/oracle/product/11.2.0/dbhome_1'

Patching component oracle.rdbms.dbscripts, 11.2.0.4.0...
Patch 20348910 successfully applied.
Log file location: /u02/app/oracle/product/11.2.0/dbhome_1/cfgtoollogs/opatch/opatch2020-04-08_10-35-48AM_1.log

OPatch succeeded.

1)	Oracle database vaults kontrol edilir.
SQL> SELECT * FROM CDB_DV_STATUS;
SELECT * FROM CDB_DV_STATUS
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL> SELECT VALUE FROM V$OPTION WHERE PARAMETER = 'Oracle Label Security';

VALUE
----------------------------------------------------------------
FALSE

2)	Oracle Label Security kontrol edilir.
SQL> SELECT VALUE FROM V$OPTION WHERE PARAMETER = 'Oracle Label Security';

VALUE
----------------------------------------------------------------
FALSE

3)	Unified Auditing kontrol edilir.
SQL> SELECT COUNT(*) FROM UNIFIED_AUDIT_TRAIL; 

  COUNT(*)
----------
         0

4)	Time Zone file kontrol edilir. Listelenen versiyon dosyası 19c homedan kopyalanır.
SQL> select * from V$TIMEZONE_FILE;

FILENAME                VERSION     CON_ID
-------------------- ---------- ----------
timezlrg_32.dat              32          0


[oracle@exa0101vm01 ~]$ ls -ltr /u02/app/oracle/product/11.2.0/dbhome_1/oracore/zoneinfo/timezlrg_32.dat
ls: cannot access /u02/app/oracle/product/11.2.0/dbhome_1/oracore/zoneinfo/timezlrg_32.dat: No such file or directory


[oracle@exa0101vm01 ~]$ cp /u02/app/oracle/product/19.0.0/dbhome_1/oracore/zoneinfo/timezlrg_32.dat /u02/app/oracle/product/11.2.0/dbhome_1/oracore/zoneinfo
[oracle@exa0101vm01 ~]$ 
[oracle@exa0101vm01 ~]$ ls -ltr /u02/app/oracle/product/11.2.0/dbhome_1/oracore/zoneinfo/timezlrg_32.dat                                                      
-rw-r--r-- 1 oracle oinstall 786909 Apr  8 10:43 /u02/app/oracle/product/11.2.0/dbhome_1/oracore/zoneinfo/timezlrg_32.dat

5)	Oracle Enterprise Manager konfigüre edilmişse sysman drop edilir.
SQL> DROP USER sysman CASCADE;
DROP USER sysman CASCADE
          *
ERROR at line 1:
ORA-01918: user 'SYSMAN' does not exist

6)	Rac veritabanı ise cluster database false ile değiştirilir.
[oracle@exa0101vm01 ~]$ cd $ORACLE_HOME/rdbms/admin
[oracle@exa0101vm01 admin]$ 

SQL> show parameter CLUSTER_DATABASE

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
cluster_database                     boolean     FALSE

7)	Restorepoint oluşturulur.
[oracle@exa0101vm01 admin]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Apr 8 10:46:56 2020
Version 19.6.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.6.0.0.0

SQL> shu immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.

SQL> startup mount 
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 1.0737E+11 bytes
Fixed Size                 23086728 bytes
Variable Size            6.4290E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers              111128576 bytes
Database mounted.
SQL> CREATE RESTORE POINT before_downgrade11204 GUARANTEE FLASHBACK DATABASE;

Restore point created.

SQL> shu immediate;
ORA-01109: database not open


Database dismounted.
ORACLE instance shut down.

8)	Downgrade işlemine başlanır.
SQL> startup downgrade
ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance
ORACLE instance started.

Total System Global Area 1.0737E+11 bytes
Fixed Size                 23086728 bytes
Variable Size            6.4290E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers              111128576 bytes
Database mounted.
Database opened.

[oracle@exa0101vm01 admin]$ cd $ORACLE_HOME/bin 
[oracle@exa0101vm01 bin]$ chmod 755 dbdowngrade

[oracle@exa0101vm01 bin]$ ./dbdowngrade 10 dk.
Downgrading noncdb
SPOOL /u02/app/oracle/product/19.0.0/dbhome_1/cfgtoollogs/downgrade/catdwgrd.log

SQL> Rem ***********************************************************************
SQL> Rem END catdwgrd.sql
SQL> Rem ***********************************************************************
SQL> 
SQL> SPOOL OFF


[oracle@exa0101vm01 bin]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Apr 8 11:02:02 2020
Version 19.6.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.6.0.0.0

SQL> shu immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL>

Yeni home set edilir.

[oracle@exa0101vm01 ~]$ echo $ORACLE_HOME
/u02/app/oracle/product/11.2.0/dbhome_1
[oracle@exa0101vm01 ~]$ echo $ORACLE_SID
FODB19


[oracle@exa0101vm01 ~]$ cd $ORACLE_HOME/rdbms/admin
[oracle@exa0101vm01 admin]$ sqlplus / as sysdba

SQL*Plus: Release 11.2.0.4.0 Production on Wed Apr 8 11:04:52 2020

Copyright (c) 1982, 2013, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> STARTUP UPGRADE
ORACLE instance started.

Total System Global Area 1.0689E+11 bytes
Fixed Size                  2265864 bytes
Variable Size            6.3888E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers               55242752 bytes
Database mounted.
Database opened.


SQL> show parameter cluster_database

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
cluster_database                     boolean     FALSE


SPOOL /tmp/reload_Fodb.log

@$ORACLE_HOME/rdbms/admin/catrelod.sql   15 dk.


SPOOL OFF

SQL> SELECT dbms_registry_sys.time_stamp('relod_end') AS timestamp FROM DUAL;

TIMESTAMP
--------------------------------------------------------------------------------
COMP_TIMESTAMP RELOD_END  2020-04-08 11:53:02

1 row selected.

SQL> 
SQL> Rem =======================================================================
SQL> Rem Display new versions and status
SQL> Rem =======================================================================
SQL> 
SQL> column comp_name format a35
SQL> SELECT comp_name, status, substr(version,1,10) as version
  2  from dba_server_registry order by modified;

COMP_NAME                           STATUS      VERSION
----------------------------------- ----------- ----------
Oracle Database Packages and Types  VALID       11.2.0.4.0
Oracle Database Catalog Views       INVALID     11.2.0.4.0
JServer JAVA Virtual Machine        VALID       11.2.0.4.0
Oracle XDK                          VALID       11.2.0.4.0
Oracle Database Java Packages       VALID       11.2.0.4.0
Oracle XML Database                 VALID       11.2.0.4.0
Oracle Real Application Clusters    VALID       11.2.0.4.0
Oracle Workspace Manager            VALID       11.2.0.4.0

8 rows selected.

SQL> 
SQL> DOC
DOC>#######################################################################
DOC>#######################################################################
DOC>
DOC>   The above query lists the SERVER components now loaded in the
DOC>   database, along with their current version and status.
DOC>
DOC>   Please review the status and version columns and look for
DOC>   any errors in the spool log file.  If there are errors in the spool
DOC>   file, or any components are not VALID or not the correct 10.1.0
DOC>   patch version, consult the downgrade chapter of the current release
DOC>   Database Upgrade book.
DOC>
DOC>   Next shutdown immediate, restart for normal operation, and then
DOC>   run utlrp.sql to recompile any invalid application objects.
DOC>
DOC>#######################################################################
DOC>#######################################################################
DOC>#
SQL> 
SQL> Rem *******************************************************************
SQL> Rem END catrelod.sql
SQL> Rem *******************************************************************
SQL>
SQL> SHUTDOWN IMMEDIATE
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> STARTUP
ORACLE instance started.

Total System Global Area 1.0689E+11 bytes
Fixed Size                  2265864 bytes
Variable Size            6.3888E+10 bytes
Database Buffers         4.2950E+10 bytes
Redo Buffers               55242752 bytes
Database mounted.
Database opened.

9)	Utlrp çalıştırılır.
SQL> @$ORACLE_HOME/rdbms/admin/utlrp.sql

10)	 İnvalid component kontrolü yapılır.
SQL> column comp_name format a35
     SELECT comp_name, status, substr(version,1,10) as version
     from dba_server_registry order by modified;

COMP_NAME                           STATUS      VERSION
----------------------------------- ----------- ----------
Oracle Database Catalog Views       VALID       11.2.0.4.0
Oracle Workspace Manager            VALID       11.2.0.4.0
Oracle Database Packages and Types  VALID       11.2.0.4.0
Oracle Database Java Packages       VALID       11.2.0.4.0
JServer JAVA Virtual Machine        VALID       11.2.0.4.0
Oracle XDK                          VALID       11.2.0.4.0
Oracle XML Database                 VALID       11.2.0.4.0
Oracle Real Application Clusters    VALID       11.2.0.4.0

8 rows selected.

11)	Veritabanı resetlog komutu ile açılır.
SQL> alter database open resetlogs;

Database altered.

*****************************************************************************

DB Vault ve OUD için 11g --> 19c Upgrade Aşamaları 
4 Eylül 2020 Cuma
09:14



PRE-UPGRADE	
Component - Explanation
connect dvowner 
GRANT DV_PATCH_ADMIN to SYS;
	DB Vault 




Connect sys as sysdba

Truncate table SYSTEM.aud$ ; 

CONNECT SYS AS SYSDBA

Truncate table SYSTEM.aud$ ;

ORACLE_HOME_19c/rdbms/admin/olspreupgrade.sql
ORACLE_HOME_19c/rdbms/admin/emremove.sql
ORACLE_HOME_19c/oraolap/admin/catnoamd.sql	DB Vault 
connect dvowner 
REVOKE DV_PATCH_ADMIN from SYS;	DB Vault 
ORACLE_HOME_19c profile içinde
Env komutu ile ORACLE_HOME ve ORACLE_BASE değerlerine bakılır yoksa set edilir

Cluster ortamı varsa

srvctl getenv database -d DBNAME

ORACLE_HOME veya ORACLE_BASE'de eksiklik varsa

srvctl setenv database -d DBNAME -t ORACLE_BASE=	OUD -
ORACLE_HOME
ORACLE_BASE kontrolü

( Zorunlu değil )

cp ORACLE_HOME_11g/network/admin/ldap.ora ORACLE_HOME_19c/network/admin	OUD - ldap.ora

ORACLE_HOME_11g/network/admin/sqlnet.ora dosyası aşağıdaki oluşturulur

NAMES.DIRECTORY_PATH= (TNSNAMES, EZCONNECT)

SQLNET.ALLOWED_LOGON_VERSION_SERVER=10
SQLNET.ALLOWED_LOGON_VERSION_CLIENT=10	OUD - sqlnet.ora
11g DB nin Wallet Dosya directory 'yü bul
Sqlnet.ora içine veya aşağıdaki Directory lere bak
$ORACLE_HOME/admin/DBNAME/wallet
$ORACLE_BASE/admin/DBNAME/wallet

WALLET_LOKASYON ( Wallet'ın bulunduğu Directory adıdır )	11g DB'de Wallet dosyasının bulunması

cp WALLET_LOKASYON/*.* ORACLE_HOME_19c/admin/DBNAME/wallet	Wallet Dosyası kopyalanır

DB VAULT DISABLE EDİLMEDEN STANDART UPGRADE YAPILIR
	
POST-UPGRADE	
connect dvowner 
Exec dvsys.dbms_macadm.enable_dv();	DB Vault Enable
DB Restart	
Connect sys as sysdba

column name format a25 
column status format a10

select * from DBA_DV_STATUS; 

NAME |STATUS | CON_ID
-------------------------|----------|----------
DV_APP_PROTECTION |NOT CONFIG| 0
|URED |

DV_CONFIGURE_STATUS |TRUE | 0
DV_ENABLE_STATUS |TRUE | 0



select name, status from DBA_OLS_STATUS;

NAME |STATUS
-------------------------|----------
OLS_CONFIGURE_STATUS |TRUE
OLS_DIRECTORY_STATUS |FALSE
OLS_ENABLE_STATUS |TRUE

column comp_name format a50 
column status format a10 
select comp_id,comp_name,status from dba_registry; 

COMP_ID |COMP_NAME |STATUS
----------|--------------------------------------------------|----------
CATALOG |Oracle Database Catalog Views |VALID
CATPROC |Oracle Database Packages and Types |VALID
JAVAVM |JServer JAVA Virtual Machine |VALID
XML |Oracle XDK |VALID
CATJAVA |Oracle Database Java Packages |VALID
APS |OLAP Analytic Workspace |VALID
RAC |Oracle Real Application Clusters |VALID
OWM |Oracle Workspace Manager |VALID
CONTEXT |Oracle Text |VALID
XDB |Oracle XML Database |VALID
ORDIM |Oracle Multimedia |VALID
SDO |Spatial |VALID
XOQ |Oracle OLAP API |VALID
APEX |Oracle Application Express |VALID
OLS |Oracle Label Security |VALID
DV |Oracle Database Vault |VALID	DB Vault test
DB Server üzerinden

Sqlplus u**/Passwd 	OUD Test
PC Client üzerinden

Sqlplus u**/Passwd@TNS
	OUD Test
Guardium ORACLE_HOME 19c Home ile update edilir	


